<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è¬ä¿®å¾©å°ˆå®¶ - ä¸€å°ä¸€å’¨è©¢é ç´„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <!-- å¼•å…¥åœ“é«”å­— -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        /* å°ˆæ¥­ä»£è¬ä¿®å¾©å°ˆå®¶é¢¨æ ¼ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'M PLUS Rounded 1c', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a1931 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        /* èƒŒæ™¯è£é£¾ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(74, 144, 226, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.06) 0%, transparent 50%);
            z-index: -1;
        }
        
        .form-container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-section {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            padding: 35px 40px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
        }
        
        .logo {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            letter-spacing: 1.5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .sub-logo {
            font-size: 1.2rem;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .header-section h1 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }
        
        .expert-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .form-content {
            padding: 40px;
            min-height: 500px;
            position: relative;
        }
        
        .form-step {
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        .form-step.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .question-group {
            margin-bottom: 32px;
            padding: 25px;
            background: rgba(249, 250, 251, 0.8);
            border-radius: 18px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.3s ease;
        }
        
        .question-group:hover {
            background: white;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
            border-color: rgba(209, 213, 219, 0.8);
        }
        
        .question-group h3 {
            font-size: 1.3rem;
            color: #1e40af;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .question-group h3 i {
            color: #3b82f6;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #374151;
            font-size: 1.05rem;
        }
        
        .required::after {
            content: " *";
            color: #ef4444;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            color: #374151;
            font-family: 'M PLUS Rounded 1c', 'Microsoft JhengHei', sans-serif;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        /* æ•¸æ“šç¶²æ ¼æ¨£å¼ */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .data-grid input {
            text-align: center;
            padding: 16px 10px;
        }
        
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 15px;
        }
        
        .radio-option,
        .checkbox-option {
            width: 100%;
        }
        
        .radio-option input,
        .checkbox-option input {
            display: none;
        }
        
        .radio-option label,
        .checkbox-option label {
            display: block;
            padding: 20px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            margin-bottom: 0;
            color: #4b5563;
        }
        
        .radio-option input:checked + label,
        .checkbox-option input:checked + label {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), white);
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15);
        }
        
        .expert-note {
            background: linear-gradient(135deg, rgba(167, 243, 208, 0.2), rgba(209, 250, 229, 0.1));
            border-left: 4px solid #10b981;
            padding: 18px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 0.95rem;
            color: #065f46;
            line-height: 1.6;
        }
        
        .expert-note strong {
            color: #047857;
        }
        
        .warning-box {
            background: linear-gradient(135deg, rgba(254, 243, 199, 0.3), rgba(254, 243, 199, 0.1));
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
        }
        
        .warning-box h4 {
            color: #92400e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .warning-box h4 i {
            color: #f59e0b;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(229, 231, 235, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #3b82f6, #0ea5e9);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.3) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            text-align: center;
            padding: 15px 40px;
            background: #f8fafc;
            color: #64748b;
            font-size: 0.9rem;
            font-weight: 500;
            border-bottom: 1px solid #e2e8f0;
        }
        
        /* æ™‚é–“é¸æ“‡å„ªåŒ– */
        .time-selection-group {
            background: white;
            padding: 25px;
            border-radius: 18px;
            border: 2px solid #e2e8f0;
            margin-top: 20px;
        }
        
        .time-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .time-option {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .time-option:hover {
            border-color: #3b82f6;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.1);
        }
        
        .time-option.selected {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), white);
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.15);
        }
        
        .time-option .time-label {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .time-option .time-note {
            font-size: 0.85rem;
            color: #6b7280;
        }
        
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #e5e7eb;
        }
        
        .btn {
            padding: 16px 36px;
            border: none;
            border-radius: 14px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
            transform: translateX(-100%);
        }
        
        .btn:hover::after {
            animation: btnShimmer 0.8s;
        }
        
        @keyframes btnShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .btn-prev {
            background: white;
            color: #4b5563;
            border: 2px solid #d1d5db;
        }
        
        .btn-prev:hover {
            border-color: #9ca3af;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .btn-next,
        .btn-submit {
            background: linear-gradient(to right, #3b82f6, #0ea5e9);
            color: white;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-next:hover,
        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* ç¢ºèªé é¢å„ªåŒ– */
        .confirmation {
            text-align: center;
            padding: 50px 20px;
        }
        
        .confirmation i {
            font-size: 5rem;
            color: #10b981;
            margin-bottom: 25px;
            animation: scaleIn 0.8s ease;
        }
        
        @keyframes scaleIn {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .confirmation h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .confirmation p {
            color: #4b5563;
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.7;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .appointment-details {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 20px;
            padding: 35px;
            margin: 35px auto;
            max-width: 650px;
            text-align: left;
            border: 1px solid #e2e8f0;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.05);
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 18px;
            padding-bottom: 18px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }
        
        .detail-label {
            font-weight: 600;
            width: 180px;
            color: #1e40af;
            font-size: 1rem;
        }
        
        .detail-value {
            flex: 1;
            color: #374151;
            font-size: 1rem;
        }
        
        /* ç¤¾ç¾¤å¼•å°æ¨¡å¡Š */
        .community-section {
            background: linear-gradient(135deg, rgba(240, 249, 255, 0.9) 0%, rgba(224, 242, 254, 0.9) 100%);
            border-radius: 20px;
            padding: 35px;
            margin: 35px auto;
            max-width: 650px;
            text-align: center;
            border: 1px solid rgba(186, 230, 253, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .community-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, rgba(56, 189, 248, 0.05) 0%, transparent 50%);
            z-index: 0;
        }
        
        .community-section h3 {
            color: #0369a1;
            margin-bottom: 20px;
            font-size: 1.5rem;
            position: relative;
            z-index: 1;
        }
        
        .community-points {
            text-align: left;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }
        
        .community-point {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .community-point:hover {
            background: white;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .point-icon {
            font-size: 1.5rem;
            color: #0ea5e9;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .point-content {
            flex: 1;
        }
        
        .point-content p {
            color: #374151;
            margin: 0;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .community-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        
        .community-btn {
            padding: 16px 32px;
            border-radius: 14px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .community-btn.instagram {
            background: linear-gradient(to right, #E1306C, #C13584);
            color: white;
        }
        
        .community-btn.whatsapp {
            background: linear-gradient(to right, #25D366, #128C7E);
            color: white;
        }
        
        .community-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .form-container {
                margin: 10px;
                border-radius: 20px;
            }
            
            .header-section {
                padding: 25px 20px;
            }
            
            .form-content {
                padding: 25px 20px;
            }
            
            .logo {
                font-size: 2.2rem;
            }
            
            .header-section h1 {
                font-size: 1.5rem;
            }
            
            .data-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .question-group {
                padding: 20px;
            }
            
            .time-options {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 14px 25px;
                font-size: 1rem;
            }
            
            .form-navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-prev,
            .btn-next {
                width: 100%;
                justify-content: center;
            }
            
            .detail-row {
                flex-direction: column;
            }
            
            .detail-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .community-buttons {
                flex-direction: column;
            }
            
            .community-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* å°ˆæ¥­æç¤º */
        .metabolic-tip {
            background: linear-gradient(135deg, rgba(199, 210, 254, 0.2), rgba(199, 210, 254, 0.1));
            border-left: 4px solid #4f46e5;
            padding: 18px;
            border-radius: 12px;
            margin: 15px 0;
            font-size: 0.95rem;
            color: #3730a3;
            line-height: 1.6;
        }
        
        .metabolic-tip strong {
            color: #4f46e5;
        }
        
        /* é©—è­‰éŒ¯èª¤æ¨£å¼ */
        .validation-error {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #dc2626;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <!-- é€²åº¦æ¢ -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <!-- é€²åº¦æ–‡æœ¬ -->
        <div class="progress-text" id="progressText">
            <span id="currentStepText">æ­¥é©Ÿ 1/9</span>
        </div>
        
        <!-- è¡¨é ­ -->
        <div class="header-section">
            <div class="logo">METABOLIC LAB</div>
            <div class="sub-logo">æ•¸æ“šåŒ–ä»£è¬ä¿®å¾©</div>
            <h1>ä¸€å°ä¸€ä»£è¬ä¿®å¾©å°ˆå®¶å’¨è©¢é ç´„</h1>
            <p>ç”±æ•¸æ“šåŒ–æ¸›é‡å°ˆå®¶ç‚ºæ‚¨ç ´è§£ä»£è¬åœæ»¯æœŸï¼Œæä¾›åŸºæ–¼ç§‘å­¸è­‰æ“šçš„å€‹æ€§åŒ–è§£æ±ºæ–¹æ¡ˆ</p>
            <div class="expert-badge">
                <i class="fas fa-chart-line"></i> å°ˆæ³¨ä»£è¬ä¿®å¾© â€¢ æ•¸æ“šé©…å‹•çµæœ
            </div>
        </div>
        
        <!-- è¡¨å–®å…§å®¹ -->
        <div class="form-content">
            <form id="consultationForm">
                <!-- æ­¥é©Ÿ 1: ä»‹ç´¹èˆ‡åŒæ„ -->
                <div class="form-step active" id="step1">
                    <div class="question-group">
                        <h3><i class="fas fa-exclamation-circle"></i> é‡è¦äº‹é …èªªæ˜</h3>
                        <p>æ­¤å’¨è©¢å°‡ç”±ä»£è¬ä¿®å¾©å°ˆå®¶ç‚ºæ‚¨åˆ†æä»£è¬æ•¸æ“šï¼Œç ´è§£æ‚¨åœ¨æ¸›é‡/é«”æ…‹æ”¹å–„éç¨‹ä¸­é‡åˆ°çš„åœæ»¯æœŸå•é¡Œã€‚</p>
                        <p>æ¥ä¸‹ä¾†æˆ‘å€‘æœƒå•å¹¾å€‹é—œéµå•é¡Œï¼Œè«‹èªçœŸå¡«å¯«ï¼Œä»¥ä¾¿æˆ‘å€‘ç‚ºæœƒè­°åšå¥½å……åˆ†çš„æ•¸æ“šæº–å‚™ã€‚</p>
                        
                        <div class="warning-box">
                            <h4><i class="fas fa-clock"></i> è«‹æ³¨æ„</h4>
                            <p>ç‚ºäº†ç¢ºä¿æ™‚é–“èƒ½èšç„¦åœ¨çœŸæ­£å¸Œæœ›ç²å¾—æ•¸æ“šåŒ–è§£æ±ºæ–¹æ¡ˆçš„äººèº«ä¸Šï¼Œé€™å€‹å’¨è©¢ä¸é©ç”¨æ–¼ï¼š</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>å–®ç´”æƒ³è©¢å•é€šç”¨æ¸›é‡æ–¹æ³•çš„äºº</li>
                                <li>æš«æ™‚æ²’æœ‰è¡Œå‹•è¨ˆåŠƒå’ŒåŸ·è¡Œæ„é¡˜çš„äºº</li>
                                <li>åƒ…å°‹æ±‚å…è²»å»ºè­°è€Œä¸è€ƒæ…®å°ˆæ¥­æœå‹™çš„äºº</li>
                            </ul>
                            <p style="margin-top: 15px;">æœƒè­°ç•¶æ—¥ï¼Œè«‹ç©ºå‡º60åˆ†é˜ä¸¦åœ¨å®‰éœã€ä¸è¢«æ‰“æ“¾çš„ç’°å¢ƒä¸­é€²è¡Œæœƒè­°ã€‚è‹¥ç„¡æ•…æœªå‡ºå¸­ï¼Œå°‡å–æ¶ˆå¾€å¾Œå…è²»æœƒè­°è³‡æ ¼ã€‚</p>
                        </div>
                        
                        <p><strong>è«‹ç¢ºèªæ‚¨å·²ç­è§£ä»¥ä¸Šäº‹é …ï¼š</strong></p>
                        
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="understandYes" name="understand" value="æˆ‘ç­è§£ä¸¦åŒæ„" required>
                                <label for="understandYes">æˆ‘ç­è§£ä¸¦åŒæ„ä¸Šè¿°æ‰€æœ‰äº‹é …</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="understandNo" name="understand" value="æˆ‘ä¸ç­è§£">
                                <label for="understandNo">æˆ‘ä¸ç­è§£æˆ–ä¸åŒæ„éƒ¨åˆ†äº‹é …</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 2: åŸºæœ¬è¯ç¹«è³‡æ–™ -->
                <div class="form-step" id="step2">
                    <div class="question-group">
                        <h3><i class="fas fa-user-circle"></i> æ‚¨çš„è¯ç¹«ä¿¡æ¯</h3>
                        
                        <label for="igName" class="required">Instagram ç”¨æˆ¶å</label>
                        <input type="text" id="igName" name="igName" placeholder="è«‹å¡«å¯«æ‚¨çš„Instagramç”¨æˆ¶å" required>
                        <div class="metabolic-tip">
                            <strong>å°ˆæ¥­æç¤ºï¼š</strong> æˆ‘å€‘å°‡é€šéInstagramåˆ†äº«ä»£è¬å°çŸ¥è­˜å’ŒæˆåŠŸæ¡ˆä¾‹ï¼Œè«‹ç¢ºä¿ç”¨æˆ¶åæ­£ç¢ºã€‚
                        </div>
                        
                        <label for="email" class="required">é›»å­éƒµç®±</label>
                        <input type="email" id="email" name="email" placeholder="è«‹å¡«å¯«æ‚¨çš„å¸¸ç”¨é›»å­éƒµç®±" required>
                        
                        <label for="phone" class="required">è¯çµ¡é›»è©±</label>
                        <input type="text" id="phone" name="phone" placeholder="è«‹å¡«å¯«æ‚¨çš„è¯çµ¡é›»è©±" required>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 3: å¹´é½¡ç¢ºèª -->
                <div class="form-step" id="step3">
                    <div class="question-group">
                        <h3><i class="fas fa-birthday-cake"></i> å¹´é½¡ç¢ºèª</h3>
                        <label class="required">æ‚¨æ˜¯å¦å·²å¹´æ»¿23æ­²ï¼Ÿ</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="ageYes" name="age" value="æ˜¯ï¼Œå·²æ»¿23æ­²" required>
                                <label for="ageYes">æ˜¯ï¼Œæˆ‘å·²æ»¿23æ­²</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="ageNo" name="age" value="å¦ï¼Œæœªæ»¿23æ­²" required>
                                <label for="ageNo">å¦ï¼Œæˆ‘æœªæ»¿23æ­²</label>
                            </div>
                        </div>
                        <div class="expert-note">
                            <strong>ç‚ºä»€éº¼éœ€è¦å¹´é½¡ä¿¡æ¯ï¼Ÿ</strong> ä»£è¬ç‡èˆ‡å¹´é½¡å¯†åˆ‡ç›¸é—œï¼Œç­è§£å¹´é½¡æœ‰åŠ©æ–¼æˆ‘å€‘ç‚ºæ‚¨æä¾›æ›´ç²¾å‡†çš„ä»£è¬ä¿®å¾©å»ºè­°ã€‚
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 4: ä»£è¬æ•¸æ“šæ”¶é›† -->
                <div class="form-step" id="step4">
                    <div class="question-group">
                        <h3><i class="fas fa-chart-bar"></i> ä»£è¬è©•ä¼°åŸºç¤æ•¸æ“š</h3>
                        <label class="required">è«‹æä¾›ä»¥ä¸‹æ•¸æ“šï¼Œä»¥ä¾¿é€²è¡Œåˆæ­¥ä»£è¬è©•ä¼°</label>
                        <div class="data-grid">
                            <input type="text" id="gender" name="gender" placeholder="æ€§åˆ¥ï¼ˆç”·/å¥³ï¼‰" required>
                            <input type="number" id="age" name="age" placeholder="å¹´é½¡" min="18" max="80" required>
                            <input type="number" id="height" name="height" placeholder="èº«é«˜ (cm)" min="100" max="250" required>
                            <input type="number" id="weight" name="weight" step="0.1" placeholder="é«”é‡ (kg)" min="30" max="200" required>
                            <input type="number" id="waist" name="waist" step="0.1" placeholder="è…°åœ (cm)" required>
                        </div>
                        <div class="expert-note">
                            <strong>ç‚ºä»€éº¼éœ€è¦è…°åœæ•¸æ“šï¼Ÿ</strong> è…°åœæ˜¯è©•ä¼°å…§è‡Ÿè„‚è‚ªèˆ‡ä»£è¬å¥åº·çš„é—œéµæŒ‡æ¨™ï¼Œå°æ–¼åˆ¶å®šç²¾å‡†çš„ä»£è¬ä¿®å¾©æ–¹æ¡ˆè‡³é—œé‡è¦ã€‚
                        </div>
                        
                        <label for="occupation" class="required">è·æ¥­/æ—¥å¸¸æ´»å‹•æ°´å¹³</label>
                        <input type="text" id="occupation" name="occupation" placeholder="ä¾‹å¦‚ï¼šè¾¦å…¬å®¤ä¹…åæ—/é†«è­·äººå“¡è¼ªç­/æ•™å¸«/å¥èº«æ•™ç·´" required>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 5: ä»£è¬å•é¡Œåˆ†æ -->
                <div class="form-step" id="step5">
                    <div class="question-group">
                        <h3><i class="fas fa-stethoscope"></i> ä»£è¬å•é¡Œè¨ºæ–·</h3>
                        
                        <label for="problem" class="required">Q1: æ‚¨ç›®å‰çš„æ¸›é‡/é«”æ…‹æ”¹å–„æ­£è™•æ–¼å“ªå€‹éšæ®µï¼Ÿæ˜¯å¦é‡åˆ°äº†åœæ»¯æœŸï¼ˆé«”é‡/å°ºå¯¸è¶…é4å‘¨ç„¡è®ŠåŒ–ï¼‰ï¼Ÿè«‹å…·é«”æè¿°ã€‚</label>
                        <textarea id="problem" name="problem" rows="4" placeholder="è«‹è©³ç´°æè¿°æ‚¨ç›®å‰æ‰€è™•çš„éšæ®µã€é‡åˆ°çš„åœæ»¯æœŸæƒ…æ³ï¼Œä»¥åŠæŒçºŒæ™‚é–“..." required></textarea>
                        
                        <label for="attempts" class="required">Q2: ç‚ºäº†çªç ´ç¾ç‹€ï¼Œæ‚¨å·²ç¶“å˜—è©¦éå“ªäº›æ–¹æ³•ï¼Ÿï¼ˆä¾‹å¦‚ï¼šç”Ÿé…®ã€168æ–·é£Ÿã€é«˜å¼·åº¦é‹å‹•ã€ä»£é¤ç­‰ï¼‰æ•ˆæœå¦‚ä½•ï¼Ÿè«‹ç°¡è¿°ã€‚</label>
                        <textarea id="attempts" name="attempts" rows="4" placeholder="è«‹åˆ—å‡ºæ‚¨å˜—è©¦éçš„æ–¹æ³•ã€æŒçºŒæ™‚é–“ä»¥åŠå…·é«”æ•ˆæœ..." required></textarea>
                    </div>
                    
                    <div class="metabolic-tip">
                        <strong>å°ˆæ¥­åˆ†æï¼š</strong> ç­è§£æ‚¨å·²å˜—è©¦çš„æ–¹æ³•æœ‰åŠ©æ–¼æˆ‘å€‘åˆ†ææ‚¨çš„ä»£è¬é©æ‡‰æ€§ï¼Œé¿å…é‡å¾©ç„¡æ•ˆç­–ç•¥ï¼Œæ‰¾åˆ°çœŸæ­£çš„ä»£è¬ç“¶é ¸ã€‚
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 6: é£²é£Ÿèˆ‡ç”Ÿæ´»ç¿’æ…£ -->
                <div class="form-step" id="step6">
                    <div class="question-group">
                        <h3><i class="fas fa-utensils"></i> ç•¶å‰é£²é£Ÿèˆ‡ç”Ÿæ´»ç¿’æ…£</h3>
                        
                        <label for="diet" class="required">è«‹ç°¡è¿°æ‚¨ç›®å‰çš„å…¨æ—¥é£²é£Ÿçµæ§‹èˆ‡æ™‚é–“</label>
                        <textarea id="diet" name="diet" rows="4" placeholder="ä¾‹å¦‚ï¼šæ—©é¤ï¼šä¸åƒ/ åˆé¤ï¼šå¤–é£Ÿä¾¿ç•¶ï¼Œé£¯åŠç¢—/ æ™šé¤ï¼šå®¶è£¡ç…®ï¼Œä¸€ç¢—é£¯ï¼Œé’èœï¼Œé›èƒ¸è‚‰/ å®µå¤œï¼šå¶çˆ¾åƒæ°´æœ" required></textarea>
                        
                        <label class="required">æ‚¨çš„ä¸»è¦é£²é£Ÿåå¥½ï¼Ÿï¼ˆå¯å¤šé¸ï¼‰</label>
                        <div class="checkbox-group">
                            <div class="checkbox-option">
                                <input type="checkbox" id="pref1" name="dietPref" value="å¤–é£Ÿç‚ºä¸»">
                                <label for="pref1">å¤–é£Ÿç‚ºä¸»ï¼ˆé¤å»³/å¤–è³£ï¼‰</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="pref2" name="dietPref" value="è‡ªå·±çƒ¹é£ª">
                                <label for="pref2">è‡ªå·±çƒ¹é£ªï¼ˆå¯æ§åˆ¶é£Ÿæï¼‰</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="pref3" name="dietPref" value="æ‰‹æ–é£²/ç”œé»">
                                <label for="pref3">æ¯å‘¨3æ¬¡ä»¥ä¸Šæ‰‹æ–é£²/ç”œé»</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="pref4" name="dietPref" value="å®µå¤œç¿’æ…£">
                                <label for="pref4">æœ‰åƒå®µå¤œçš„ç¿’æ…£</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="pref5" name="dietPref" value="é£²é£Ÿä¸è¦å¾‹">
                                <label for="pref5">é£²é£Ÿæ™‚é–“ä¸è¦å¾‹</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 7: å‹•æ©Ÿèˆ‡æŠ•è³‡æ„é¡˜ -->
                <div class="form-step" id="step7">
                    <div class="question-group">
                        <h3><i class="fas fa-bullseye"></i> ç›®æ¨™èˆ‡æ‰¿è«¾è©•ä¼°</h3>
                        
                        <label for="goal" class="required">æ‚¨çš„å…·é«”ç›®æ¨™æ˜¯ä»€éº¼ï¼Ÿ</label>
                        <textarea id="goal" name="goal" rows="3" placeholder="ä¾‹å¦‚ï¼š3å€‹æœˆå…§æ¸›é‡5kgã€è…°åœæ¸›å°‘8cmã€å­¸æœƒè‡ªä¸»è¦åŠƒä»£è¬ä¿®å¾©é£²é£Ÿ..." required></textarea>
                        
                        <label class="required">æ‚¨å°é”æˆç›®æ¨™çš„æ±ºå¿ƒå¦‚ä½•ï¼Ÿ</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="commit1" name="commitment" value="éå¸¸å …å®š" required>
                                <label for="commit1">ã€éå¸¸å …å®šã€æˆ‘é¡˜æ„ç‚ºé”æˆç›®æ¨™åšå‡ºå¿…è¦æ”¹è®Š</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="commit2" name="commitment" value="é¡˜æ„å˜—è©¦" required>
                                <label for="commit2">ã€é¡˜æ„å˜—è©¦ã€å¦‚æœæ–¹æ³•åˆé©ï¼Œæˆ‘æœƒèªçœŸåŸ·è¡Œ</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="commit3" name="commitment" value="éœ€è¦è§€æœ›" required>
                                <label for="commit3">ã€éœ€è¦è§€æœ›ã€æƒ³å…ˆç­è§£æ–¹æ¡ˆï¼Œå†æ±ºå®šæ˜¯å¦åŸ·è¡Œ</label>
                            </div>
                        </div>
                        
                        <div class="question-group" style="margin-top: 30px; background: rgba(254, 226, 226, 0.1);">
                            <label class="required">ç‚ºäº†ç²å¾—æ•¸æ“šåŒ–ä»£è¬ä¿®å¾©æ–¹æ¡ˆèˆ‡æŒçºŒæŒ‡å°ï¼Œå¦‚æœèƒ½æ‹¿åˆ°çµæœï¼Œæ‚¨æ˜¯å¦é¡˜æ„æŠ•è³‡è¶…éHKD$10,000ï¼Ÿï¼ˆå¯åˆ†æœŸï¼‰</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="invest1" name="investment" value="é¡˜æ„æŠ•è³‡" required>
                                    <label for="invest1">HKD$10,000å°æˆ‘å¯è¡Œï¼Œæˆ‘çœŸå¿ƒæƒ³è§£æ±ºä»£è¬å•é¡Œï¼</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="invest2" name="investment" value="å¯èƒ½æŠ•è³‡" required>
                                    <label for="invest2">å¯èƒ½æœ‰é»å£“åŠ›ï¼Œä½†å¦‚æœæ–¹æ¡ˆçœŸçš„æœ‰æ•ˆï¼Œæˆ‘æœƒè€ƒæ…®æŠ•è³‡</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="invest3" name="investment" value="ç„¡æ³•æŠ•è³‡" required>
                                    <label for="invest3">ç›®å‰ç„¡æ³•æ‰¿æ“”é€™å€‹é ç®—</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 8: æ™‚é–“æ„å‘èˆ‡è£œå……ä¿¡æ¯ -->
                <div class="form-step" id="step8">
                    <div class="question-group">
                        <h3><i class="fas fa-calendar-alt"></i> é ç´„æ™‚é–“æ„å‘</h3>
                        <p>æäº¤æ‚¨çš„é¦–é¸æ™‚é–“æ„å‘ï¼Œæˆ‘å€‘çš„ä»£è¬ä¿®å¾©é¡§å•å°‡åœ¨24å°æ™‚å…§èˆ‡æ‚¨ç¢ºèªæœ€çµ‚æœƒè­°æ™‚é–“ã€‚</p>
                        
                        <div class="time-selection-group">
                            <label for="preferredDate" class="required">é¦–é¸å’¨è©¢æ—¥æœŸ</label>
                            <input type="date" id="preferredDate" name="preferredDate" required>
                            
                            <label class="required" style="margin-top: 25px;">é¦–é¸æ™‚é–“æ®µï¼ˆè«‹é¸æ“‡1-2å€‹ï¼‰</label>
                            <div class="time-options">
                                <div class="time-option" data-time="09:00-10:00">
                                    <div class="time-label">ä¸Šåˆ 09:00-10:00</div>
                                    <div class="time-note">é©åˆæ™¨é–“ä»£è¬åˆ†æ</div>
                                </div>
                                <div class="time-option" data-time="14:00-15:00">
                                    <div class="time-label">ä¸‹åˆ 14:00-15:00</div>
                                    <div class="time-note">é©åˆåˆé¤å¾Œå’¨è©¢</div>
                                </div>
                                <div class="time-option" data-time="19:00-20:00">
                                    <div class="time-label">æ™šä¸Š 19:00-20:00</div>
                                    <div class="time-note">é©åˆä¸‹ç­å¾Œæ·±åº¦å’¨è©¢</div>
                                </div>
                                <div class="time-option" data-time="20:30-21:30">
                                    <div class="time-label">æ™šä¸Š 20:30-21:30</div>
                                    <div class="time-note">é©åˆæ™šé–“æ”¾é¬†æ™‚æ®µ</div>
                                </div>
                            </div>
                        </div>
                        
                        <label for="additionalInfo" style="margin-top: 30px;">ä»»ä½•å…¶ä»–æƒ³è®“æˆ‘å€‘çŸ¥é“çš„ä»£è¬ç›¸é—œä¿¡æ¯</label>
                        <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="ä¾‹å¦‚ï¼šç‰¹æ®Šå¥åº·ç‹€æ³ã€ç”¨è—¥æƒ…æ³ã€éå¾€é«”æª¢æ•¸æ“šã€å®¶æ—ä»£è¬ç—…å²ç­‰..."></textarea>
                    </div>
                </div>
                
                <!-- æ­¥é©Ÿ 9: ç¢ºèªèˆ‡æäº¤ -->
                <div class="form-step" id="step9">
                    <div class="confirmation">
                        <i class="fas fa-check-circle"></i>
                        <h2>é ç´„ç”³è«‹å·²æäº¤æˆåŠŸï¼</h2>
                        <p>æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„ä»£è¬ä¿®å¾©å’¨è©¢ç”³è«‹ï¼Œç¢ºèªä¿¡å·²ç™¼é€åˆ°æ‚¨çš„é›»å­éƒµç®±</p>
                        
                        <div class="appointment-details" id="appointmentDetails">
                            <!-- é ç´„è©³æƒ…å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                        </div>
                        
                        <p><strong>ä¸‹ä¸€æ­¥ï¼š</strong> æˆ‘å€‘çš„ä»£è¬ä¿®å¾©å°ˆå®¶å°‡åœ¨24å°æ™‚å…§é€šéInstagramæˆ–é›»è©±èˆ‡æ‚¨ç¢ºèªæœ€çµ‚æœƒè­°æ™‚é–“åŠæœƒè­°éˆæ¥ã€‚</p>
                        <p>è«‹å‹™å¿…ç•™æ„æ‚¨çš„éƒµä»¶å’ŒInstagramæ¶ˆæ¯ï¼Œä¸¦æº–æ™‚åƒåŠ å’¨è©¢æœƒè­°ã€‚</p>
                        
                        <!-- ç¤¾ç¾¤å¼•å°æ¨¡å¡Š -->
                        <div class="community-section">
                            <h3>åœ¨ç­‰å¾…æœƒè­°æœŸé–“ï¼Œæ‚¨å¯ä»¥ï¼š</h3>
                            <div class="community-points">
                                <div class="community-point">
                                    <div class="point-icon">ğŸ“±</div>
                                    <div class="point-content">
                                        <p><strong>é—œæ³¨æˆ‘å€‘çš„ Instagram</strong> - ç²å–æ¯æ—¥ä»£è¬å°çŸ¥è­˜ã€æˆåŠŸæ¡ˆä¾‹åˆ†äº«èˆ‡ç§‘å­¸æ¸›é‡è³‡è¨Š</p>
                                    </div>
                                </div>
                                <div class="community-point">
                                    <div class="point-icon">ğŸ’¬</div>
                                    <div class="point-content">
                                        <p><strong>åŠ å…¥ WhatsApp ä»£è¬ä¿®å¾©ç¤¾ç¾¤</strong> - èˆ‡åŒæœŸå­¸å“¡äº¤æµç¶“é©—ï¼Œç²å–ç¤¾ç¾¤å°ˆå±¬æ”¯æŒèˆ‡å•ç­”</p>
                                    </div>
                                </div>
                                <div class="community-point">
                                    <div class="point-icon">ğŸ“Š</div>
                                    <div class="point-content">
                                        <p><strong>è¨˜éŒ„æ‚¨çš„ä¸‰æ—¥é£²é£Ÿ</strong> - ç‚ºå’¨è©¢æœƒè­°æº–å‚™ï¼Œè¨˜éŒ„æ‚¨é€£çºŒä¸‰å¤©çš„é£²é£Ÿæƒ…æ³ï¼ˆé£Ÿç‰©ã€æ™‚é–“ã€ä»½é‡ï¼‰</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="community-buttons">
                                <a href="https://instagram.com/metabolic_lab_hk" class="community-btn instagram" target="_blank">
                                    <i class="fab fa-instagram"></i> å‰å¾€ Instagram
                                </a>
                                <a href="https://wa.me/85255556666" class="community-btn whatsapp" target="_blank">
                                    <i class="fab fa-whatsapp"></i> åŠ å…¥ WhatsApp ç¤¾ç¾¤
                                </a>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-submit" onclick="window.location.reload()">
                            <i class="fas fa-plus-circle"></i> å»ºç«‹æ–°çš„å’¨è©¢é ç´„
                        </button>
                    </div>
                </div>
                
                <!-- å°èˆªæŒ‰éˆ• -->
                <div class="form-navigation" id="formNavigation">
                    <button type="button" class="btn btn-prev" id="prevBtn">
                        <i class="fas fa-arrow-left"></i> ä¸Šä¸€æ­¥
                    </button>
                    <button type="button" class="btn btn-next" id="nextBtn">
                        ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // ç³»çµ±é…ç½®
        // ============================================
        const CONFIG = {
            // EmailJS é…ç½® - æ ¹æ“šæ‚¨çš„æˆªåœ–ï¼Œæ¨¡æ¿ä½¿ç”¨ dappointment_id è€Œä¸æ˜¯ appointment_id
            EMAILJS: {
                PUBLIC_KEY: 't7Qdr66KKPecj63b3',
                SERVICE_ID: 'service_00tszor',
                TEMPLATE_ID: 'template_sa6vpqu'
            },
            // ç¤¾ç¾¤éˆæ¥
            SOCIAL: {
                INSTAGRAM: 'https://instagram.com/metabolic_lab_hk',
                WHATSAPP: 'https://wa.me/85255556666'
            }
        };

        // åˆå§‹åŒ– EmailJS
        (function() {
            try {
                emailjs.init(CONFIG.EMAILJS.PUBLIC_KEY);
                console.log('EmailJS åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('EmailJS åˆå§‹åŒ–å¤±æ•—:', error);
            }
        })();

        // ============================================
        // å…¨å±€è®Šé‡èˆ‡ç‹€æ…‹ç®¡ç†
        // ============================================
        let currentStep = 1;
        const totalSteps = 9;
        let selectedTimes = [];
        let formData = {
            timePreferences: []
        };
        
        // æ­¥é©Ÿæ¨™é¡Œæ˜ å°„
        const stepTitles = [
            "æ­¡è¿èˆ‡ç¢ºèª",
            "è¯ç¹«ä¿¡æ¯",
            "å¹´é½¡ç¢ºèª", 
            "ä»£è¬æ•¸æ“š",
            "å•é¡Œè¨ºæ–·",
            "é£²é£Ÿåˆ†æ",
            "ç›®æ¨™æ‰¿è«¾",
            "æ™‚é–“æ„å‘",
            "å®Œæˆ"
        ];

        // ============================================
        // DOM åŠ è¼‰èˆ‡åˆå§‹åŒ–
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–çµ„ä»¶
            initDatePicker();
            initTimeSelection();
            updateProgress();
            updateNavigation();
            
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            setupEventListeners();
            
            // åˆå§‹åŒ–è¡¨å–®é©—è­‰æç¤º
            initValidation();
            
            console.log('è¡¨å–®åˆå§‹åŒ–å®Œæˆ');
        });

        // ============================================
        // æ ¸å¿ƒåŠŸèƒ½å‡½æ•¸
        // ============================================

        // åˆå§‹åŒ–æ—¥æœŸé¸æ“‡å™¨
        function initDatePicker() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const formattedDate = tomorrow.toISOString().split('T')[0];
            document.getElementById('preferredDate').min = formattedDate;
            
            // è¨­ç½®é»˜èªå€¼ç‚º3å¤©å¾Œ
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 3);
            const defaultFormattedDate = defaultDate.toISOString().split('T')[0];
            document.getElementById('preferredDate').value = defaultFormattedDate;
        }

        // åˆå§‹åŒ–æ™‚é–“é¸æ“‡
        function initTimeSelection() {
            const timeOptions = document.querySelectorAll('.time-option');
            timeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const time = this.dataset.time;
                    
                    if (this.classList.contains('selected')) {
                        // å–æ¶ˆé¸æ“‡
                        this.classList.remove('selected');
                        const index = selectedTimes.indexOf(time);
                        if (index > -1) {
                            selectedTimes.splice(index, 1);
                        }
                    } else {
                        // é¸æ“‡ï¼ˆæœ€å¤š2å€‹ï¼‰
                        if (selectedTimes.length < 2) {
                            this.classList.add('selected');
                            selectedTimes.push(time);
                        } else {
                            showValidationError('æœ€å¤šåªèƒ½é¸æ“‡2å€‹æ™‚é–“æ®µ');
                        }
                    }
                    
                    // æ›´æ–°è¡¨å–®æ•¸æ“š
                    formData.timePreferences = [...selectedTimes];
                    
                    // æ›´æ–°å°èˆªæŒ‰éˆ•ç‹€æ…‹
                    updateNavigation();
                });
            });
        }

        // åˆå§‹åŒ–è¡¨å–®é©—è­‰
        function initValidation() {
            // ç‚ºæ‰€æœ‰å¿…å¡«å­—æ®µæ·»åŠ è¦–è¦ºæç¤º
            const requiredFields = document.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                field.addEventListener('blur', function() {
                    if (!this.value.trim()) {
                        this.style.borderColor = '#ef4444';
                    } else {
                        this.style.borderColor = '#e5e7eb';
                    }
                });
            });
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // ä¸‹ä¸€æ­¥æŒ‰éˆ•
            document.getElementById('nextBtn').addEventListener('click', function() {
                try {
                    if (validateCurrentStep()) {
                        if (currentStep === totalSteps - 1) {
                            handleFormSubmit();
                        } else {
                            goToStep(currentStep + 1);
                        }
                    }
                } catch (error) {
                    console.error('å°èˆªéŒ¯èª¤:', error);
                    showValidationError('ç³»çµ±éŒ¯èª¤ï¼Œè«‹åˆ·æ–°é é¢é‡è©¦');
                }
            });
            
            // ä¸Šä¸€æ­¥æŒ‰éˆ•
            document.getElementById('prevBtn').addEventListener('click', function() {
                if (currentStep > 1) {
                    goToStep(currentStep - 1);
                }
            });
            
            // æŠ•è³‡æ„é¡˜è®Šæ›´ç›£è½
            document.querySelectorAll('input[name="investment"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'ç„¡æ³•æŠ•è³‡') {
                        showDisqualificationMessage();
                    }
                });
            });
        }

        // é¡¯ç¤ºä¸ç¬¦åˆè³‡æ ¼ä¿¡æ¯
        function showDisqualificationMessage() {
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“é¡¯ç¤ºéæç¤º
            if (document.querySelector('.disqualification-message')) {
                return;
            }
            
            const message = `
                <div class="disqualification-message" style="background: #fee2e2; border-left: 4px solid #dc2626; padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <h4 style="color: #991b1b; margin-bottom: 10px;">é‡è¦æç¤º</h4>
                    <p>ç”±æ–¼å’¨è©¢éœ€æ±‚çœ¾å¤šï¼Œæˆ‘å€‘ç›®å‰å„ªå…ˆæœå‹™æœ‰é ç®—æŠ•å…¥ä»£è¬ä¿®å¾©è¨ˆåŠƒçš„å­¸å“¡ã€‚</p>
                    <p>æ‚¨å¯ä»¥ï¼š</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>é—œæ³¨æˆ‘å€‘çš„ Instagram ç²å–å…è²»ä»£è¬çŸ¥è­˜</li>
                        <li>åŠ å…¥ WhatsApp ç¤¾ç¾¤ç­è§£å…¶ä»–å­¸å“¡çš„é€²å±•</li>
                        <li>ç•¶æ‚¨çš„é ç®—ç‹€æ³æ”¹è®Šæ™‚ï¼Œé‡æ–°æäº¤ç”³è«‹</li>
                    </ul>
                </div>
            `;
            
            // åœ¨æŠ•è³‡é¸é …å¾Œæ’å…¥æç¤º
            const investmentGroup = document.querySelector('input[name="investment"]:checked')?.closest('.question-group');
            if (investmentGroup) {
                investmentGroup.insertAdjacentHTML('beforeend', message);
            }
        }

        // åˆ‡æ›æ­¥é©Ÿ
        function goToStep(step) {
            // éš±è—ç•¶å‰æ­¥é©Ÿ
            document.querySelectorAll('.form-step').forEach(stepEl => {
                stepEl.classList.remove('active');
            });
            
            // é¡¯ç¤ºç›®æ¨™æ­¥é©Ÿ
            document.getElementById(`step${step}`).classList.add('active');
            
            // æ›´æ–°ç•¶å‰æ­¥é©Ÿ
            currentStep = step;
            
            // æ›´æ–°UI
            updateProgress();
            updateNavigation();
            
            // æ»¾å‹•åˆ°é ‚éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // æ›´æ–°æ­¥é©Ÿæ–‡æœ¬
            updateStepText();
        }

        // æ›´æ–°é€²åº¦
        function updateProgress() {
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // æ›´æ–°æ­¥é©Ÿæ–‡æœ¬
        function updateStepText() {
            const stepText = `æ­¥é©Ÿ ${currentStep}/${totalSteps}: ${stepTitles[currentStep - 1] || ''}`;
            document.getElementById('currentStepText').textContent = stepText;
        }

        // æ›´æ–°å°èˆªæŒ‰éˆ•
        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = currentStep === 1 ? 'none' : 'flex';
            
            if (currentStep === totalSteps) {
                document.getElementById('formNavigation').style.display = 'none';
            } else {
                document.getElementById('formNavigation').style.display = 'flex';
                
                if (currentStep === totalSteps - 1) {
                    nextBtn.innerHTML = 'æäº¤ç”³è«‹ <i class="fas fa-paper-plane"></i>';
                } else {
                    nextBtn.innerHTML = 'ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i>';
                }
                
                // å¦‚æœæ˜¯æ­¥é©Ÿ8ä¸”æœªé¸æ“‡æ™‚é–“ï¼Œç¦ç”¨ä¸‹ä¸€æ­¥æŒ‰éˆ•
                if (currentStep === 8 && selectedTimes.length === 0) {
                    nextBtn.disabled = true;
                } else {
                    nextBtn.disabled = false;
                }
            }
        }

        // é©—è­‰ç•¶å‰æ­¥é©Ÿ
        function validateCurrentStep() {
            const currentStepEl = document.getElementById(`step${currentStep}`);
            
            // ç‰¹æ®Šé©—è­‰ï¼šæ­¥é©Ÿ8éœ€è¦é¸æ“‡è‡³å°‘ä¸€å€‹æ™‚é–“æ®µ
            if (currentStep === 8 && selectedTimes.length === 0) {
                showValidationError('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹é¦–é¸æ™‚é–“æ®µ');
                return false;
            }
            
            const requiredFields = currentStepEl.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (field.type === 'radio') {
                    const name = field.name;
                    const checked = currentStepEl.querySelector(`input[name="${name}"]:checked`);
                    if (!checked) {
                        const labelText = getFieldLabel(field);
                        showValidationError(`è«‹é¸æ“‡ã€Œ${labelText}ã€`);
                        return false;
                    }
                } else if (field.type === 'checkbox') {
                    const name = field.name;
                    const checkboxes = currentStepEl.querySelectorAll(`input[name="${name}"]`);
                    const checked = currentStepEl.querySelector(`input[name="${name}"]:checked`);
                    if (!checked && checkboxes.length > 0) {
                        const labelText = getFieldLabel(checkboxes[0]);
                        showValidationError(`è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ã€Œ${labelText}ã€é¸é …`);
                        return false;
                    }
                } else {
                    if (!field.value.trim()) {
                        const labelText = getFieldLabel(field);
                        showValidationError(`è«‹å¡«å¯«ã€Œ${labelText}ã€`);
                        return false;
                    }
                }
            }
            
            return true;
        }

        // ç²å–å­—æ®µæ¨™ç±¤æ–‡æœ¬çš„è¼”åŠ©å‡½æ•¸
        function getFieldLabel(field) {
            if (field.labels && field.labels.length > 0) {
                return field.labels[0].textContent.replace('*', '').trim();
            }
            
            // å˜—è©¦å¾çˆ¶å…ƒç´ ç²å–æ¨™ç±¤
            const label = field.closest('.question-group')?.querySelector('label');
            if (label) {
                return label.textContent.replace('*', '').replace('required', '').trim();
            }
            
            // å˜—è©¦ç²å–å‰ä¸€å€‹labelå…ƒç´ 
            const prevLabel = field.previousElementSibling;
            if (prevLabel && prevLabel.tagName === 'LABEL') {
                return prevLabel.textContent.replace('*', '').trim();
            }
            
            return field.name || 'æ­¤å­—æ®µ';
        }

        // é¡¯ç¤ºé©—è­‰éŒ¯èª¤
        function showValidationError(message) {
            // ç§»é™¤ç¾æœ‰çš„éŒ¯èª¤æç¤º
            const existingErrors = document.querySelectorAll('.validation-error');
            existingErrors.forEach(error => error.remove());
            
            // å‰µå»ºéŒ¯èª¤æç¤ºå…ƒç´ 
            const errorEl = document.createElement('div');
            errorEl.className = 'validation-error';
            errorEl.innerHTML = `<strong><i class="fas fa-exclamation-circle"></i> è«‹å®Œå–„ä¿¡æ¯ï¼š</strong> ${message}`;
            
            // æ’å…¥åˆ°è¡¨å–®å°èˆªå‰
            const nav = document.getElementById('formNavigation');
            if (nav) {
                nav.parentNode.insertBefore(errorEl, nav);
                
                // 5ç§’å¾Œç§»é™¤
                setTimeout(() => {
                    errorEl.style.opacity = '0';
                    errorEl.style.transform = 'translateY(-10px)';
                    setTimeout(() => errorEl.remove(), 300);
                }, 5000);
                
                // æ»¾å‹•åˆ°éŒ¯èª¤ä½ç½®
                errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // æ”¶é›†è¡¨å–®æ•¸æ“š
        function collectFormData() {
            // æ”¶é›†å¾©é¸æ¡†å€¼
            const dietPreferences = Array.from(document.querySelectorAll('input[name="dietPref"]:checked')).map(cb => cb.value);
            
            return {
                // è¯ç¹«ä¿¡æ¯
                igName: document.getElementById('igName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                
                // åŸºæœ¬è³‡æ–™
                age: document.querySelector('input[name="age"]:checked')?.value,
                
                // ä»£è¬æ•¸æ“š
                gender: document.getElementById('gender').value,
                ageNum: document.getElementById('age').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                waist: document.getElementById('waist').value,
                occupation: document.getElementById('occupation').value,
                
                // ä»£è¬å•é¡Œ
                problem: document.getElementById('problem').value,
                attempts: document.getElementById('attempts').value,
                
                // é£²é£Ÿåˆ†æ
                diet: document.getElementById('diet').value,
                dietPreferences: dietPreferences,
                
                // ç›®æ¨™èˆ‡æ‰¿è«¾
                goal: document.getElementById('goal').value,
                commitment: document.querySelector('input[name="commitment"]:checked')?.value,
                investment: document.querySelector('input[name="investment"]:checked')?.value,
                
                // æ™‚é–“æ„å‘
                preferredDate: document.getElementById('preferredDate').value,
                timePreferences: selectedTimes,
                additionalInfo: document.getElementById('additionalInfo').value,
                
                // åŒæ„äº‹é …
                understand: document.querySelector('input[name="understand"]:checked')?.value,
                
                // æ™‚é–“æˆ³
                submissionTime: new Date().toISOString()
            };
        }

        // ç”Ÿæˆé ç´„ID
        function generateAppointmentId() {
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            
            return `MET${year}${month}${day}${random}`;
        }

        // ç™¼é€ç¢ºèªéƒµä»¶ - æ ¹æ“šæ‚¨çš„æˆªåœ–ï¼Œæ¨¡æ¿ä½¿ç”¨ dappointment_id è€Œä¸æ˜¯ appointment_id
        async function sendConfirmationEmail(formData, appointmentId) {
            try {
                // æº–å‚™æ¨¡æ¿åƒæ•¸ - æ ¹æ“šæ‚¨çš„ EmailJS æ¨¡æ¿æˆªåœ–
                // æ¨¡æ¿ä¸­ä½¿ç”¨äº† ((dappointment_id)) è€Œä¸æ˜¯ ((appointment_id))
                const templateParams = {
                    to_name: formData.igName || 'å®¢æˆ¶',
                    to_email: formData.email,      // æ”¶ä»¶äººéƒµç®±åœ°å€
                    reply_to: formData.email,      // å›è¦†åœ°å€
                    dappointment_id: appointmentId, // é‡è¦ï¼šæ ¹æ“šæ‚¨çš„æˆªåœ–ï¼Œæ¨¡æ¿ä½¿ç”¨ dappointment_id
                    appointment_date: formData.preferredDate,
                    appointment_time: selectedTimes.join(', '),
                    contact: `Instagram: ${formData.igName || 'æœªæä¾›'}, é›»è©±: ${formData.phone || 'æœªæä¾›'}`,
                    current_year: new Date().getFullYear().toString()
                };
                
                console.log('ç™¼é€éƒµä»¶åƒæ•¸:', templateParams);
                
                // æª¢æŸ¥ EmailJS é…ç½®
                console.log('ä½¿ç”¨ EmailJS é…ç½®:', {
                    serviceId: CONFIG.EMAILJS.SERVICE_ID,
                    templateId: CONFIG.EMAILJS.TEMPLATE_ID,
                    publicKey: CONFIG.EMAILJS.PUBLIC_KEY
                });
                
                const response = await emailjs.send(
                    CONFIG.EMAILJS.SERVICE_ID,
                    CONFIG.EMAILJS.TEMPLATE_ID,
                    templateParams
                );
                
                console.log('éƒµä»¶ç™¼é€æˆåŠŸ:', response);
                return { 
                    success: true, 
                    message: 'ç¢ºèªéƒµä»¶å·²ç™¼é€',
                    emailResponse: response 
                };
                
            } catch (error) {
                console.error('éƒµä»¶ç™¼é€å¤±æ•—:', error);
                console.error('éŒ¯èª¤è©³æƒ…:', {
                    status: error.status,
                    text: error.text,
                    message: error.message
                });
                return { 
                    success: false, 
                    message: `éƒµä»¶ç™¼é€å¤±æ•—: ${error.text || error.message || 'æœªçŸ¥éŒ¯èª¤'}`,
                    error: error 
                };
            }
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
        function saveToLocalStorage(formData, appointmentId, emailSent, backupSent) {
            const appointments = JSON.parse(localStorage.getItem('metabolic_appointments')) || [];
            
            const appointment = {
                id: appointmentId,
                timestamp: new Date().toISOString(),
                ...formData,
                emailSent: emailSent,
                backupSent: backupSent,
                status: 'pending_confirmation',
                version: '2.0'
            };
            
            appointments.push(appointment);
            localStorage.setItem('metabolic_appointments', JSON.stringify(appointments));
            
            console.log('é ç´„å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å„²:', appointment);
            return appointment;
        }

        // é¡¯ç¤ºæˆåŠŸä¿¡æ¯
        function showSuccessMessage(formData, appointmentId, emailResult, backupResult) {
            // æ ¼å¼åŒ–æ—¥æœŸ
            const date = new Date(formData.preferredDate);
            const formattedDate = date.toLocaleDateString('zh-TW', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            const detailsHTML = `
                <div class="detail-row">
                    <div class="detail-label">é ç´„ç·¨è™Ÿ</div>
                    <div class="detail-value"><strong>${appointmentId}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">æ‚¨çš„ç¨±å‘¼</div>
                    <div class="detail-value">${formData.igName || 'æœªæä¾›'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">è¯ç¹«éƒµç®±</div>
                    <div class="detail-value">${formData.email}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">é¦–é¸æ—¥æœŸ</div>
                    <div class="detail-value">${formattedDate}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">é¦–é¸æ™‚é–“</div>
                    <div class="detail-value">${selectedTimes.join(', ') || 'æœªé¸æ“‡'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ä¸»è¦ç›®æ¨™</div>
                    <div class="detail-value">${formData.goal ? formData.goal.substring(0, 50) + (formData.goal.length > 50 ? '...' : '') : 'æœªæä¾›'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ä»£è¬æ±ºå¿ƒ</div>
                    <div class="detail-value">${formData.commitment || 'æœªæä¾›'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">éƒµä»¶ç‹€æ…‹</div>
                    <div class="detail-value">
                        ${emailResult.success ? 
                            '<span style="color: #10b981;"><i class="fas fa-check-circle"></i> ç¢ºèªéƒµä»¶å·²ç™¼é€</span>' : 
                            '<span style="color: #ef4444;"><i class="fas fa-exclamation-triangle"></i> éƒµä»¶ç™¼é€å¤±æ•—</span>'}
                    </div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">æ•¸æ“šå‚™ä»½</div>
                    <div class="detail-value">
                        ${backupResult.success ? 
                            '<span style="color: #10b981;"><i class="fas fa-check-circle"></i> æ•¸æ“šå·²å®‰å…¨ä¿å­˜</span>' : 
                            '<span style="color: #f59e0b;"><i class="fas fa-exclamation-circle"></i> æ•¸æ“šä¿å­˜åˆ°æœ¬åœ°</span>'}
                    </div>
                </div>
            `;
            
            document.getElementById('appointmentDetails').innerHTML = detailsHTML;
        }

        // è™•ç†è¡¨å–®æäº¤
        async function handleFormSubmit() {
            // æ”¶é›†è¡¨å–®æ•¸æ“š
            const collectedData = collectFormData();
            const appointmentId = generateAppointmentId();
            
            // é¡¯ç¤ºåŠ è¼‰ç‹€æ…‹
            const submitBtn = document.getElementById('nextBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...';
            submitBtn.disabled = true;
            
            try {
                // 1. ç™¼é€ç¢ºèªéƒµä»¶
                const emailResult = await sendConfirmationEmail(collectedData, appointmentId);
                
                // 2. ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
                const savedAppointment = saveToLocalStorage(collectedData, appointmentId, emailResult.success, true);
                
                // 3. é¡¯ç¤ºæˆåŠŸä¿¡æ¯
                showSuccessMessage(collectedData, appointmentId, emailResult, {success: true});
                
                // 4. è·³è½‰åˆ°æˆåŠŸé é¢
                goToStep(totalSteps);
                
                // 5. æ›´æ–°ç¤¾ç¾¤éˆæ¥
                updateSocialLinks();
                
            } catch (error) {
                console.error('æäº¤å¤±æ•—:', error);
                
                // é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
                const errorEl = document.createElement('div');
                errorEl.style.cssText = `
                    background: #fee2e2;
                    color: #991b1b;
                    padding: 20px;
                    border-radius: 12px;
                    margin: 20px 0;
                    border-left: 4px solid #dc2626;
                    text-align: center;
                `;
                errorEl.innerHTML = `
                    <h4 style="margin-bottom: 10px;"><i class="fas fa-exclamation-triangle"></i> æäº¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤</h4>
                    <p>ç³»çµ±ä¿å­˜äº†æ‚¨çš„é ç´„ä¿¡æ¯ï¼Œä½†éƒµä»¶ç™¼é€å¯èƒ½å¤±æ•—ã€‚</p>
                    <p>é ç´„ç·¨è™Ÿï¼š<strong>${appointmentId}</strong></p>
                    <p>è«‹è¨˜éŒ„æ­¤ç·¨è™Ÿï¼Œä¸¦é€šé Instagram èˆ‡æˆ‘å€‘è¯ç¹«ç¢ºèªã€‚</p>
                `;
                
                const nav = document.getElementById('formNavigation');
                if (nav) {
                    nav.parentNode.insertBefore(errorEl, nav);
                }
                
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                // é¡¯ç¤ºæˆåŠŸé é¢ï¼ˆå³ä½¿æœ‰éŒ¯èª¤ï¼‰
                showSuccessMessage(collectedData, appointmentId, {success: false, message: 'éƒµä»¶ç™¼é€å¤±æ•—'}, {success: true});
                goToStep(totalSteps);
                updateSocialLinks();
            }
        }

        // æ›´æ–°ç¤¾ç¾¤éˆæ¥
        function updateSocialLinks() {
            // æ›´æ–°Instagraméˆæ¥
            const instagramBtn = document.querySelector('.community-btn.instagram');
            if (instagramBtn && CONFIG.SOCIAL.INSTAGRAM) {
                instagramBtn.href = CONFIG.SOCIAL.INSTAGRAM;
            }
            
            // æ›´æ–°WhatsAppéˆæ¥
            const whatsappBtn = document.querySelector('.community-btn.whatsapp');
            if (whatsappBtn && CONFIG.SOCIAL.WHATSAPP) {
                whatsappBtn.href = CONFIG.SOCIAL.WHATSAPP;
            }
        }

        // åˆå§‹åŒ–ç¤¾äº¤éˆæ¥
        updateSocialLinks();
    </script>
</body>
</html>
