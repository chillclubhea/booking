<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代謝修復專家 - 一對一咨詢預約</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <!-- 引入圓體字 -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        /* 專業代謝修復專家風格 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'M PLUS Rounded 1c', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a1931 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        /* 背景裝飾 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(74, 144, 226, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.06) 0%, transparent 50%);
            z-index: -1;
        }
        
        .form-container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 24px;
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.15);
            overflow: hidden;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
        
        .header-section {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            padding: 40px 45px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
        }
        
        .logo {
            font-size: 3.2rem;
            font-weight: 800;
            margin-bottom: 12px;
            letter-spacing: 2px;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .sub-logo {
            font-size: 1.3rem;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
        }
        
        .header-section h1 {
            font-size: 2rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .header-section p {
            font-size: 1.15rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto 20px;
            line-height: 1.7;
            position: relative;
            z-index: 1;
        }
        
        .expert-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
            margin-top: 20px;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            position: relative;
            z-index: 1;
        }
        
        .form-content {
            padding: 45px;
            min-height: 500px;
            position: relative;
        }
        
        .form-step {
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        .form-step.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(40px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .question-group {
            margin-bottom: 35px;
            padding: 30px;
            background: rgba(249, 250, 251, 0.9);
            border-radius: 20px;
            border: 1px solid rgba(229, 231, 235, 0.6);
            transition: all 0.3s ease;
        }
        
        .question-group:hover {
            background: white;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.08);
            border-color: rgba(209, 213, 219, 0.9);
        }
        
        .question-group h3 {
            font-size: 1.4rem;
            color: #1e40af;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.1);
        }
        
        .question-group h3 i {
            color: #3b82f6;
        }
        
        .step-intro {
            font-size: 1.1rem;
            color: #4b5563;
            margin-bottom: 25px;
            line-height: 1.7;
            padding: 15px 20px;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
            font-size: 1.1rem;
        }
        
        .required::after {
            content: " *";
            color: #ef4444;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 18px 22px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            font-size: 1.05rem;
            transition: all 0.3s;
            background: white;
            color: #374151;
            font-family: 'M PLUS Rounded 1c', 'Microsoft JhengHei', sans-serif;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 5px rgba(59, 130, 246, 0.15);
        }
        
        /* 數據網格樣式 */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 18px;
            margin-top: 18px;
        }
        
        .data-grid input {
            text-align: center;
            padding: 18px 12px;
            font-weight: 500;
        }
        
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 18px;
        }
        
        .radio-option,
        .checkbox-option {
            width: 100%;
        }
        
        .radio-option input,
        .checkbox-option input {
            display: none;
        }
        
        .radio-option label,
        .checkbox-option label {
            display: block;
            padding: 22px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            margin-bottom: 0;
            color: #4b5563;
            font-size: 1.05rem;
        }
        
        .radio-option input:checked + label,
        .checkbox-option input:checked + label {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), white);
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }
        
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 18px;
        }
        
        .expert-note {
            background: linear-gradient(135deg, rgba(167, 243, 208, 0.25), rgba(209, 250, 229, 0.15));
            border-left: 5px solid #10b981;
            padding: 22px;
            border-radius: 14px;
            margin: 25px 0;
            font-size: 1rem;
            color: #065f46;
            line-height: 1.7;
        }
        
        .expert-note strong {
            color: #047857;
        }
        
        .metabolic-tip {
            background: linear-gradient(135deg, rgba(199, 210, 254, 0.25), rgba(199, 210, 254, 0.15));
            border-left: 5px solid #4f46e5;
            padding: 22px;
            border-radius: 14px;
            margin: 25px 0;
            font-size: 1rem;
            color: #3730a3;
            line-height: 1.7;
        }
        
        .metabolic-tip strong {
            color: #4f46e5;
        }
        
        .warning-box {
            background: linear-gradient(135deg, rgba(254, 243, 199, 0.35), rgba(254, 243, 199, 0.2));
            border-left: 5px solid #f59e0b;
            padding: 25px;
            border-radius: 14px;
            margin: 30px 0;
        }
        
        .warning-box h4 {
            color: #92400e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
        }
        
        .warning-box h4 i {
            color: #f59e0b;
        }
        
        .warning-box ul {
            margin-left: 25px;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        
        .warning-box li {
            margin-bottom: 8px;
            color: #92400e;
        }
        
        /* 壓力滑桿樣式 */
        .slider-container {
            margin-top: 15px;
            padding: 20px;
            background: rgba(249, 250, 251, 0.8);
            border-radius: 14px;
            border: 2px solid #e5e7eb;
        }
        
        .slider-container label {
            margin-bottom: 20px;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.95rem;
            color: #6b7280;
        }
        
        .slider-value {
            text-align: center;
            font-weight: 700;
            font-size: 1.3rem;
            color: #3b82f6;
            margin: 15px 0;
        }
        
        /* 範圍滑桿自定義樣式 */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, #10b981, #f59e0b, #ef4444);
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.5);
        }
        
        /* 進度條 */
        .progress-bar {
            height: 10px;
            background: rgba(229, 231, 235, 0.7);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #3b82f6, #0ea5e9);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            text-align: center;
            padding: 18px 45px;
            background: #f8fafc;
            color: #64748b;
            font-size: 1rem;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }
        
        /* 時間選擇優化 */
        .time-selection-group {
            background: white;
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #e2e8f0;
            margin-top: 25px;
        }
        
        .time-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 18px;
            margin-top: 25px;
        }
        
        .time-option {
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .time-option:hover {
            border-color: #3b82f6;
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.15);
        }
        
        .time-option.selected {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), white);
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.2);
        }
        
        .time-option .time-label {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .time-option .time-note {
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 35px;
            border-top: 1px solid #e5e7eb;
        }
        
        .btn {
            padding: 18px 42px;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.25) 50%, 
                transparent 100%);
            transform: translateX(-100%);
        }
        
        .btn:hover::after {
            animation: btnShimmer 0.8s;
        }
        
        @keyframes btnShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .btn-prev {
            background: white;
            color: #4b5563;
            border: 2px solid #d1d5db;
        }
        
        .btn-prev:hover {
            border-color: #9ca3af;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }
        
        .btn-next,
        .btn-submit {
            background: linear-gradient(to right, #3b82f6, #0ea5e9);
            color: white;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.35);
        }
        
        .btn-next:hover,
        .btn-submit:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.45);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* 確認頁面優化 */
        .confirmation {
            text-align: center;
            padding: 60px 30px;
        }
        
        .confirmation i {
            font-size: 5.5rem;
            color: #10b981;
            margin-bottom: 30px;
            animation: scaleIn 0.8s ease;
        }
        
        @keyframes scaleIn {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .confirmation h2 {
            color: #1e40af;
            margin-bottom: 25px;
            font-size: 2.2rem;
        }
        
        .confirmation p {
            color: #4b5563;
            margin-bottom: 30px;
            font-size: 1.15rem;
            line-height: 1.8;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .appointment-details {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 22px;
            padding: 40px;
            margin: 40px auto;
            max-width: 700px;
            text-align: left;
            border: 1px solid #e2e8f0;
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.08);
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }
        
        .detail-label {
            font-weight: 600;
            width: 200px;
            color: #1e40af;
            font-size: 1.05rem;
        }
        
        .detail-value {
            flex: 1;
            color: #374151;
            font-size: 1.05rem;
        }
        
        /* 社群引導模塊 */
        .community-section {
            background: linear-gradient(135deg, rgba(240, 249, 255, 0.95) 0%, rgba(224, 242, 254, 0.95) 100%);
            border-radius: 22px;
            padding: 40px;
            margin: 40px auto;
            max-width: 700px;
            text-align: center;
            border: 1px solid rgba(186, 230, 253, 0.9);
            position: relative;
            overflow: hidden;
        }
        
        .community-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, rgba(56, 189, 248, 0.08) 0%, transparent 50%);
            z-index: 0;
        }
        
        .community-section h3 {
            color: #0369a1;
            margin-bottom: 25px;
            font-size: 1.6rem;
            position: relative;
            z-index: 1;
        }
        
        .community-points {
            text-align: left;
            margin-bottom: 35px;
            position: relative;
            z-index: 1;
        }
        
        .community-point {
            display: flex;
            align-items: flex-start;
            margin-bottom: 18px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 14px;
            transition: all 0.3s;
        }
        
        .community-point:hover {
            background: white;
            transform: translateX(6px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        .point-icon {
            font-size: 1.6rem;
            color: #0ea5e9;
            margin-right: 18px;
            flex-shrink: 0;
        }
        
        .point-content {
            flex: 1;
        }
        
        .point-content p {
            color: #374151;
            margin: 0;
            font-size: 1.05rem;
            line-height: 1.6;
        }
        
        .community-buttons {
            display: flex;
            gap: 18px;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        
        .community-btn {
            padding: 18px 36px;
            border-radius: 16px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }
        
        .community-btn.instagram {
            background: linear-gradient(to right, #E1306C, #C13584);
            color: white;
        }
        
        .community-btn.whatsapp {
            background: linear-gradient(to right, #25D366, #128C7E);
            color: white;
        }
        
        .community-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.18);
        }
        
        /* 響應式設計 */
        @media (max-width: 992px) {
            .form-container {
                margin: 15px;
                border-radius: 22px;
            }
            
            .header-section {
                padding: 30px 25px;
            }
            
            .form-content {
                padding: 30px 25px;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .header-section h1 {
                font-size: 1.7rem;
            }
            
            .data-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .checkbox-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .question-group {
                padding: 25px;
            }
            
            .time-options {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 16px 30px;
                font-size: 1.05rem;
            }
        }
        
        @media (max-width: 768px) {
            .form-container {
                margin: 10px;
                border-radius: 20px;
            }
            
            .header-section {
                padding: 25px 20px;
            }
            
            .form-content {
                padding: 25px 20px;
            }
            
            .logo {
                font-size: 2.2rem;
            }
            
            .header-section h1 {
                font-size: 1.5rem;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .checkbox-grid {
                grid-template-columns: 1fr;
            }
            
            .question-group {
                padding: 20px;
            }
            
            .time-options {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 15px 25px;
                font-size: 1rem;
            }
            
            .form-navigation {
                flex-direction: column;
                gap: 18px;
            }
            
            .btn-prev,
            .btn-next {
                width: 100%;
                justify-content: center;
            }
            
            .detail-row {
                flex-direction: column;
            }
            
            .detail-label {
                width: 100%;
                margin-bottom: 8px;
            }
            
            .community-buttons {
                flex-direction: column;
            }
            
            .community-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* 驗證錯誤樣式 */
        .validation-error {
            background: #fee2e2;
            color: #991b1b;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid #dc2626;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 壓力滑桿值顯示 */
        .stress-display {
            text-align: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: #3b82f6;
            margin: 15px 0;
            padding: 10px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <!-- 進度條 -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <!-- 進度文本 -->
        <div class="progress-text" id="progressText">
            <span id="currentStepText">步驟 1/9</span>
            <span id="stepTitle">歡迎與確認</span>
        </div>
        
        <!-- 表頭 -->
        <div class="header-section">
            <div class="logo">METABOLIC LAB</div>
            <div class="sub-logo">代謝修復專家系統</div>
            <h1>一對一代謝根源修復專家諮詢預約</h1>
            <p>透過數據化代謝評估，找出您代謝停滯的根本原因，提供基於科學證據的個性化解決方案</p>
            <div class="expert-badge">
                <i class="fas fa-chart-line"></i> 專注代謝修復 • 根源問題解決 • 數據驅動結果
            </div>
        </div>
        
        <!-- 表單內容 -->
        <div class="form-content">
            <form id="consultationForm">
                <!-- 步驟 1: 介紹與同意 -->
                <div class="form-step active" id="step1">
                    <div class="question-group">
                        <h3><i class="fas fa-exclamation-circle"></i> 重要事項說明</h3>
                        <p class="step-intro">此為專業代謝修復諮詢，由代謝修復專家為您分析代謝數據，破解您在減重/體態改善過程中遇到的停滯期與根源問題。</p>
                        <p>接下來我們會問幾個關鍵問題，請認真填寫，以便我們為會議做好充分的數據準備。</p>
                        
                        <div class="warning-box">
                            <h4><i class="fas fa-clock"></i> 請注意</h4>
                            <p>為了確保時間能聚焦在真正希望獲得數據化解決方案的人身上，這個諮詢不適用於：</p>
                            <ul>
                                <li>單純想詢問通用減重方法的人</li>
                                <li>暫時沒有行動計劃和執行意願的人</li>
                                <li>僅尋求免費建議而不考慮專業服務的人</li>
                            </ul>
                            <p style="margin-top: 15px;">會議當日，請空出60分鐘並在安靜、不被打擾的環境中進行會議。若無故未出席，將取消往後免費會議資格。</p>
                        </div>
                        
                        <p><strong>請確認您已瞭解以上事項：</strong></p>
                        
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="understandYes" name="understand" value="我瞭解並同意" required>
                                <label for="understandYes">我瞭解並同意上述所有事項</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="understandNo" name="understand" value="我不瞭解">
                                <label for="understandNo">我不瞭解或不同意部分事項</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 步驟 2: 基本聯繫資料 -->
                <div class="form-step" id="step2">
                    <div class="question-group">
                        <h3><i class="fas fa-user-circle"></i> 您的聯繫信息</h3>
                        <p class="step-intro">請提供您的聯繫方式，我們將通過這些渠道與您確認會議詳情。</p>
                        
                        <label for="igName" class="required">Instagram 用戶名</label>
                        <input type="text" id="igName" name="igName" placeholder="請填寫您的Instagram用戶名" required>
                        <div class="metabolic-tip">
                            <strong>專業提示：</strong> 我們將通過Instagram分享代謝小知識和成功案例，請確保用戶名正確。
                        </div>
                        
                        <label for="email" class="required">電子郵箱</label>
                        <input type="email" id="email" name="email" placeholder="請填寫您的常用電子郵箱" required>
                        
                        <label for="phone" class="required">聯絡電話</label>
                        <input type="text" id="phone" name="phone" placeholder="請填寫您的聯絡電話" required>
                    </div>
                </div>
                
                <!-- 步驟 3: 年齡確認 -->
                <div class="form-step" id="step3">
                    <div class="question-group">
                        <h3><i class="fas fa-birthday-cake"></i> 年齡確認</h3>
                        <p class="step-intro">代謝率與年齡密切相關，瞭解年齡有助於我們為您提供更精準的代謝修復建議。</p>
                        
                        <label class="required">您是否已年滿23歲？</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="ageYes" name="age" value="是，已滿23歲" required>
                                <label for="ageYes">是，我已滿23歲</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="ageNo" name="age" value="否，未滿23歲" required>
                                <label for="ageNo">否，我未滿23歲</label>
                            </div>
                        </div>
                        
                        <div class="expert-note">
                            <strong>為什麼需要年齡信息？</strong> 代謝率會隨著年齡增長而變化，不同年齡層的代謝修復策略有所不同。23歲以上的代謝適應性與修復潛能通常更穩定，適合進行系統性代謝調整。
                        </div>
                    </div>
                </div>
                
                <!-- 步驟 4: 代謝健康深度評估（專業版） -->
                <div class="form-step" id="step4">
                    <div class="question-group">
                        <h3><i class="fas fa-stethoscope"></i> 代謝健康深度評估</h3>
                        <p class="step-intro">請認真回答以下問題，這些數據將幫助我們初步分析您代謝卡關的「根本原因」。</p>
                    </div>
                    
                    <!-- 基礎數據 -->
                    <div class="question-group">
                        <label class="required">基本生理數據</label>
                        <div class="data-grid">
                            <input type="text" id="gender" name="gender" placeholder="性別（男/女）" required>
                            <input type="number" id="age_detail" name="age_detail" placeholder="年齡" min="18" max="80" required>
                            <input type="number" id="height" name="height" placeholder="身高 (cm)" min="140" max="210" required>
                            <input type="number" id="weight" name="weight" step="0.1" placeholder="體重 (kg)" min="30" max="200" required>
                            <input type="number" id="waist" name="waist" step="0.1" placeholder="腰圍 (cm)" min="50" max="150" required>
                        </div>
                        <div class="metabolic-tip">
                            <strong>專業提示：</strong> 腰圍是評估內臟脂肪與代謝風險的關鍵指標。男性腰圍超過90cm、女性超過80cm，即表示代謝風險增加。
                        </div>
                    </div>
                    
                    <!-- 飲食習慣 -->
                    <div class="question-group">
                        <label class="required">1. 飲食習慣與節律</label>
                        
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="water1" name="water" value="<1L" required>
                                <label for="water1">每天喝水量少於 1 公升</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="water2" name="water" value="1-2L" required>
                                <label for="water2">每天喝水量 1-2 公升</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="water3" name="water" value=">2L" required>
                                <label for="water3">每天喝水量超過 2 公升</label>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px;">
                            <label for="last_meal">通常幾點吃最後一餐？</label>
                            <select id="last_meal" name="last_meal" required>
                                <option value="">請選擇</option>
                                <option value="19:00前">晚上 7:00 前</option>
                                <option value="19:00-20:00">晚上 7:00-8:00</option>
                                <option value="20:00-21:00">晚上 8:00-9:00</option>
                                <option value="21:00後">晚上 9:00 後</option>
                            </select>
                        </div>
                        
                        <div style="margin-top: 25px;">
                            <label for="breakfast">早餐通常吃什麼？</label>
                            <textarea id="breakfast" name="breakfast" rows="2" placeholder="例如：不吃 / 咖啡+麵包 / 雞蛋+蔬菜..." required></textarea>
                        </div>
                    </div>
                    
                    <!-- 睡眠與壓力 -->
                    <div class="question-group">
                        <label class="required">2. 睡眠與壓力水平</label>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                            <div>
                                <label for="sleep_hours">平均睡眠時數</label>
                                <select id="sleep_hours" name="sleep_hours" required>
                                    <option value="">請選擇</option>
                                    <option value="<5小時">少於 5 小時</option>
                                    <option value="5-6小時">5-6 小時</option>
                                    <option value="7-8小時">7-8 小時（理想）</option>
                                    <option value=">8小時">超過 8 小時</option>
                                </select>
                            </div>
                            <div>
                                <label for="morning_energy">起床後感覺精神嗎？</label>
                                <select id="morning_energy" name="morning_energy" required>
                                    <option value="">請選擇</option>
                                    <option value="精神飽滿">精神飽滿</option>
                                    <option value="尚可">尚可</option>
                                    <option value="有點累">有點累</option>
                                    <option value="非常疲憊">非常疲憊</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <label for="stress_level">最近壓力程度（1-10分）</label>
                            <div class="stress-display" id="stressValueDisplay">5分</div>
                            <input type="range" id="stress_level" name="stress_level" min="1" max="10" value="5" required>
                            <div class="slider-labels">
                                <span>1分（無壓力）</span>
                                <span>10分（極大壓力）</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 體質徵兆 -->
                    <div class="question-group">
                        <label class="required">3. 身體徵兆（請勾選所有符合項目）</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-option">
                                <input type="checkbox" id="symptom1" name="symptoms" value="手腳冰冷">
                                <label for="symptom1">手腳容易冰冷</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="symptom2" name="symptoms" value="下午疲勞">
                                <label for="symptom2">下午3-5點特別容易疲勞</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="symptom3" name="symptoms" value="食慾不穩定">
                                <label for="symptom3">食慾不穩定（時而沒胃口，時而暴食）</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="symptom4" name="symptoms" value="渴望甜食">
                                <label for="symptom4">特別渴望甜食或精緻澱粉</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="symptom5" name="symptoms" value="腹部肥胖">
                                <label for="symptom5">脂肪主要堆積在腹部</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="symptom6" name="symptoms" value="水腫">
                                <label for="symptom6">早上臉部或手部有浮腫現象</label>
                            </div>
                        </div>
                        
                        <div class="expert-note">
                            <strong>專業分析：</strong> 這些身體徵兆可能指向甲狀腺功能、皮質醇節律或胰島素阻抗等代謝問題。勾選項目越多，代謝調節的需求可能越高。
                        </div>
                    </div>
                </div>
                
                <!-- 步驟 5: 減肥史與動機 -->
                <div class="form-step" id="step5">
                    <div class="question-group">
                        <h3><i class="fas fa-history"></i> 減肥史與動機分析</h3>
                        <p class="step-intro">瞭解您的過往經驗與內在動機，有助於制定符合您個人特點的代謝修復方案。</p>
                        
                        <label for="problem" class="required">在減重/體態管理上，你遇到的最大問題是什麼？</label>
                        <textarea id="problem" name="problem" rows="4" placeholder="請描述您目前面臨的主要挑戰、停滯期情況，以及持續時間..." required></textarea>
                        
                        <label class="required" style="margin-top: 25px;">曾經嘗試過哪些方法？（可複選）</label>
                        <div class="checkbox-grid">
                            <div class="checkbox-option">
                                <input type="checkbox" id="method1" name="methods" value="節食">
                                <label for="method1">極低熱量節食</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="method2" name="methods" value="168斷食">
                                <label for="method2">168間歇性斷食</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="method3" name="methods" value="生酮">
                                <label for="method3">生酮飲食</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="method4" name="methods" value="高強度運動">
                                <label for="method4">高強度運動</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="method5" name="methods" value="代餐">
                                <label for="method5">代餐/奶昔</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="method6" name="methods" value="減肥藥">
                                <label for="method6">減肥藥物</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" id="method7" name="methods" value="其他">
                                <label for="method7">其他方法</label>
                            </div>
                        </div>
                        
                        <label for="pain_point" style="margin-top: 25px;">在這些嘗試中，最痛苦或最難堅持的是什麼？</label>
                        <textarea id="pain_point" name="pain_point" rows="3" placeholder="例如：一直感到飢餓 / 情緒低落 / 影響社交生活 / 停滯期令人沮喪..." required></textarea>
                        
                        <label for="goal" class="required" style="margin-top: 25px;">你想改善體態的主要動機是什麼？</label>
                        <textarea id="goal" name="goal" rows="3" placeholder="例如：健康考量 / 提升自信 / 特殊場合需求 / 改善生活品質..." required></textarea>
                    </div>
                    
                    <div class="metabolic-tip">
                        <strong>專業洞察：</strong> 瞭解您過往的嘗試與痛苦點，能幫助我們避免重複無效策略，找到真正適合您生活型態與心理狀態的代謝修復方案。
                    </div>
                </div>
                
                <!-- 步驟 6: 投資意願 -->
                <div class="form-step" id="step6">
                    <div class="question-group">
                        <h3><i class="fas fa-bullseye"></i> 目標與承諾評估</h3>
                        <p class="step-intro">代謝修復是一個需要專業指導與個人承諾的過程，瞭解您的決心與投入意願有助於我們提供適切的協助。</p>
                        
                        <label class="required">您對達成目標的決心如何？</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="commit1" name="commitment" value="非常堅定" required>
                                <label for="commit1">『非常堅定』我願意為達成目標做出必要改變</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="commit2" name="commitment" value="願意嘗試" required>
                                <label for="commit2">『願意嘗試』如果方法合適，我會認真執行</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="commit3" name="commitment" value="需要觀望" required>
                                <label for="commit3">『需要觀望』想先瞭解方案，再決定是否執行</label>
                            </div>
                        </div>
                        
                        <div class="question-group" style="margin-top: 35px; background: rgba(254, 226, 226, 0.1);">
                            <label class="required">為了獲得數據化代謝修復方案與持續指導，如果能拿到結果，您是否願意投資超過HKD$10,000？（可分期）</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="invest1" name="investment" value="願意投資" required>
                                    <label for="invest1">HKD$10,000對我可行，我真心想解決代謝問題！</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="invest2" name="investment" value="可能投資" required>
                                    <label for="invest2">可能有點壓力，但如果方案真的有效，我會考慮投資</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="invest3" name="investment" value="無法投資" required>
                                    <label for="invest3">目前無法承擔這個預算</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 步驟 7: 追隨時間與補充信息 -->
                <div class="form-step" id="step7">
                    <div class="question-group">
                        <h3><i class="fas fa-clock"></i> 追隨時間與補充信息</h3>
                        <p class="step-intro">提供這些資訊有助於我們瞭解您的背景，並為諮詢做好更充分的準備。</p>
                        
                        <label for="follow_time">您追蹤我們的內容多久了？</label>
                        <select id="follow_time" name="follow_time">
                            <option value="">請選擇</option>
                            <option value="1個月內">1個月內</option>
                            <option value="1-3個月">1-3個月</option>
                            <option value="3-6個月">3-6個月</option>
                            <option value="6個月以上">6個月以上</option>
                        </select>
                        
                        <label for="additionalInfo" style="margin-top: 25px;">任何其他想讓我們知道的代謝相關信息</label>
                        <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="例如：特殊健康狀況、用藥情況、過往體檢數據、家族代謝病史等..."></textarea>
                    </div>
                </div>
                
                <!-- 步驟 8: 會議規則確認 -->
                <div class="form-step" id="step8">
                    <div class="question-group">
                        <h3><i class="fas fa-calendar-check"></i> 會議規則確認</h3>
                        <p class="step-intro">為了確保諮詢品質，請確認您已瞭解並同意以下會議規則。</p>
                        
                        <div class="warning-box">
                            <h4><i class="fas fa-exclamation-triangle"></i> 重要會議規則</h4>
                            <ul>
                                <li>會議當日，請確保在安靜、不被打擾的環境中進行</li>
                                <li>請準時參加會議，若遲到超過15分鐘，會議將被取消</li>
                                <li>若需取消或改期，請至少提前24小時通知</li>
                                <li>若無故未出席且未事先告知，將列入系統黑名單</li>
                                <li>會議中請勿錄音或錄影</li>
                            </ul>
                            <p style="margin-top: 15px;">會議連結將在預約確認後通過Email發送給您。</p>
                        </div>
                        
                        <p><strong>請確認您已瞭解並同意以上會議規則：</strong></p>
                        
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="rulesYes" name="rules" value="我同意" required>
                                <label for="rulesYes">我同意並會遵守上述會議規則</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="rulesNo" name="rules" value="我不同意">
                                <label for="rulesNo">我不同意部分規則</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 步驟 9: 預約時間意向 -->
                <div class="form-step" id="step9">
                    <div class="question-group">
                        <h3><i class="fas fa-calendar-alt"></i> 預約時間意向</h3>
                        <p class="step-intro">提交您的首選時間意向，我們的代謝修復顧問將在24小時內與您確認最終會議時間。</p>
                        
                        <div class="time-selection-group">
                            <label for="preferredDate" class="required">首選諮詢日期</label>
                            <input type="date" id="preferredDate" name="preferredDate" required>
                            
                            <label class="required" style="margin-top: 30px;">首選時間段（請選擇1-2個）</label>
                            <div class="time-options">
                                <div class="time-option" data-time="09:00-10:00">
                                    <div class="time-label">上午 09:00-10:00</div>
                                    <div class="time-note">適合晨間代謝分析</div>
                                </div>
                                <div class="time-option" data-time="14:00-15:00">
                                    <div class="time-label">下午 14:00-15:00</div>
                                    <div class="time-note">適合午餐後諮詢</div>
                                </div>
                                <div class="time-option" data-time="19:00-20:00">
                                    <div class="time-label">晚上 19:00-20:00</div>
                                    <div class="time-note">適合下班後深度諮詢</div>
                                </div>
                                <div class="time-option" data-time="20:30-21:30">
                                    <div class="time-label">晚上 20:30-21:30</div>
                                    <div class="time-note">適合晚間放鬆時段</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 步驟 10: 確認與提交 -->
                <div class="form-step" id="step10">
                    <div class="confirmation">
                        <i class="fas fa-check-circle"></i>
                        <h2>預約申請已提交成功！</h2>
                        <p>我們已收到您的代謝修復諮詢申請，確認信已發送到您的電子郵箱</p>
                        
                        <div class="appointment-details" id="appointmentDetails">
                            <!-- 預約詳情將由JavaScript動態生成 -->
                        </div>
                        
                        <p><strong>下一步：</strong> 我們的代謝修復專家將在24小時內通過Instagram或電話與您確認最終會議時間及會議連結。</p>
                        <p>請務必留意您的郵件和Instagram消息，並準時參加諮詢會議。</p>
                        
                        <!-- 社群引導模塊 -->
                        <div class="community-section">
                            <h3>在等待會議期間，您可以：</h3>
                            <div class="community-points">
                                <div class="community-point">
                                    <div class="point-icon">📱</div>
                                    <div class="point-content">
                                        <p><strong>關注我們的 Instagram</strong> - 獲取每日代謝小知識、成功案例分享與科學減重資訊</p>
                                    </div>
                                </div>
                                <div class="community-point">
                                    <div class="point-icon">💬</div>
                                    <div class="point-content">
                                        <p><strong>加入 WhatsApp 代謝修復社群</strong> - 與同期學員交流經驗，獲取社群專屬支持與問答</p>
                                    </div>
                                </div>
                                <div class="community-point">
                                    <div class="point-icon">📊</div>
                                    <div class="point-content">
                                        <p><strong>記錄您的三日飲食</strong> - 為諮詢會議準備，記錄您連續三天的飲食情況（食物、時間、份量）</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="community-buttons">
                                <a href="https://instagram.com/metabolic_lab_hk" class="community-btn instagram" target="_blank">
                                    <i class="fab fa-instagram"></i> 前往 Instagram
                                </a>
                                <a href="https://wa.me/85255556666" class="community-btn whatsapp" target="_blank">
                                    <i class="fab fa-whatsapp"></i> 加入 WhatsApp 社群
                                </a>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-submit" onclick="window.location.reload()">
                            <i class="fas fa-plus-circle"></i> 建立新的諮詢預約
                        </button>
                    </div>
                </div>
                
                <!-- 導航按鈕 -->
                <div class="form-navigation" id="formNavigation">
                    <button type="button" class="btn btn-prev" id="prevBtn">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button type="button" class="btn btn-next" id="nextBtn">
                        下一步 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // 系統配置
        // ============================================
        const CONFIG = {
            // EmailJS 配置
            EMAILJS: {
                PUBLIC_KEY: 't7Qdr66KKPecj63b3',
                SERVICE_ID: 'service_00tszor',
                TEMPLATE_ID: 'template_sa6vpqu'
            },
            // 社群連結
            SOCIAL: {
                INSTAGRAM: 'https://instagram.com/metabolic_lab_hk',
                WHATSAPP: 'https://wa.me/85255556666'
            }
        };

        // 初始化 EmailJS
        (function() {
            try {
                emailjs.init(CONFIG.EMAILJS.PUBLIC_KEY);
                console.log('EmailJS 初始化完成');
            } catch (error) {
                console.error('EmailJS 初始化失敗:', error);
            }
        })();

        // ============================================
        // 全局變量與狀態管理
        // ============================================
        let currentStep = 1;
        const totalSteps = 10;
        let selectedTimes = [];
        let formData = {
            timePreferences: []
        };
        
        // 步驟標題映射
        const stepTitles = [
            "歡迎與確認",
            "聯繫信息",
            "年齡確認", 
            "代謝健康深度評估",
            "減肥史與動機",
            "目標與承諾",
            "補充信息",
            "會議規則確認",
            "預約時間意向",
            "完成"
        ];

        // ============================================
        // DOM 加載與初始化
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化組件
            initDatePicker();
            initTimeSelection();
            initStressSlider();
            updateProgress();
            updateNavigation();
            
            // 設置事件監聽器
            setupEventListeners();
            
            // 初始化表單驗證提示
            initValidation();
            
            console.log('表單初始化完成');
        });

        // ============================================
        // 核心功能函數
        // ============================================

        // 初始化日期選擇器
        function initDatePicker() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const formattedDate = tomorrow.toISOString().split('T')[0];
            document.getElementById('preferredDate').min = formattedDate;
            
            // 設置默認值為3天後
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 3);
            const defaultFormattedDate = defaultDate.toISOString().split('T')[0];
            document.getElementById('preferredDate').value = defaultFormattedDate;
        }

        // 初始化時間選擇
        function initTimeSelection() {
            const timeOptions = document.querySelectorAll('.time-option');
            timeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const time = this.dataset.time;
                    
                    if (this.classList.contains('selected')) {
                        // 取消選擇
                        this.classList.remove('selected');
                        const index = selectedTimes.indexOf(time);
                        if (index > -1) {
                            selectedTimes.splice(index, 1);
                        }
                    } else {
                        // 選擇（最多2個）
                        if (selectedTimes.length < 2) {
                            this.classList.add('selected');
                            selectedTimes.push(time);
                        } else {
                            showValidationError('最多只能選擇2個時間段');
                        }
                    }
                    
                    // 更新表單數據
                    formData.timePreferences = [...selectedTimes];
                    
                    // 更新導航按鈕狀態
                    updateNavigation();
                });
            });
        }

        // 初始化壓力滑桿
        function initStressSlider() {
            const stressSlider = document.getElementById('stress_level');
            const stressDisplay = document.getElementById('stressValueDisplay');
            
            // 初始化顯示
            stressDisplay.textContent = stressSlider.value + '分';
            
            // 監聽滑桿變化
            stressSlider.addEventListener('input', function() {
                stressDisplay.textContent = this.value + '分';
            });
        }

        // 初始化表單驗證
        function initValidation() {
            // 為所有必填字段添加視覺提示
            const requiredFields = document.querySelectorAll('[required]');
            requiredFields.forEach(field => {
                field.addEventListener('blur', function() {
                    if (!this.value.trim()) {
                        this.style.borderColor = '#ef4444';
                        this.style.backgroundColor = '#fef2f2';
                    } else {
                        this.style.borderColor = '#e5e7eb';
                        this.style.backgroundColor = 'white';
                    }
                });
            });
        }

        // 設置事件監聽器
        function setupEventListeners() {
            // 下一步按鈕
            document.getElementById('nextBtn').addEventListener('click', function() {
                try {
                    if (validateCurrentStep()) {
                        if (currentStep === totalSteps - 1) {
                            handleFormSubmit();
                        } else {
                            goToStep(currentStep + 1);
                        }
                    }
                } catch (error) {
                    console.error('導航錯誤:', error);
                    showValidationError('系統錯誤，請刷新頁面重試');
                }
            });
            
            // 上一步按鈕
            document.getElementById('prevBtn').addEventListener('click', function() {
                if (currentStep > 1) {
                    goToStep(currentStep - 1);
                }
            });
            
            // 投資意願變更監聽
            document.querySelectorAll('input[name="investment"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === '無法投資') {
                        showDisqualificationMessage();
                    }
                });
            });
        }

        // 顯示不符合資格信息
        function showDisqualificationMessage() {
            // 檢查是否已經顯示過提示
            if (document.querySelector('.disqualification-message')) {
                return;
            }
            
            const message = `
                <div class="disqualification-message" style="background: #fee2e2; border-left: 5px solid #dc2626; padding: 22px; border-radius: 14px; margin: 25px 0;">
                    <h4 style="color: #991b1b; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-exclamation-circle"></i> 重要提示
                    </h4>
                    <p style="color: #991b1b; margin-bottom: 12px;">由於諮詢需求眾多，我們目前優先服務有預算投入代謝修復計劃的學員。</p>
                    <p style="color: #991b1b; margin-bottom: 15px;">您可以：</p>
                    <ul style="margin-left: 25px; margin-top: 10px; color: #991b1b;">
                        <li style="margin-bottom: 8px;">關注我們的 Instagram 獲取免費代謝知識</li>
                        <li style="margin-bottom: 8px;">加入 WhatsApp 社群瞭解其他學員的進展</li>
                        <li>當您的預算狀況改變時，重新提交申請</li>
                    </ul>
                </div>
            `;
            
            // 在投資選項後插入提示
            const investmentGroup = document.querySelector('input[name="investment"]:checked')?.closest('.question-group');
            if (investmentGroup) {
                investmentGroup.insertAdjacentHTML('beforeend', message);
                
                // 滾動到提示位置
                setTimeout(() => {
                    document.querySelector('.disqualification-message').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }, 300);
            }
        }

        // 切換步驟
        function goToStep(step) {
            // 隱藏當前步驟
            document.querySelectorAll('.form-step').forEach(stepEl => {
                stepEl.classList.remove('active');
            });
            
            // 顯示目標步驟
            document.getElementById(`step${step}`).classList.add('active');
            
            // 更新當前步驟
            currentStep = step;
            
            // 更新UI
            updateProgress();
            updateNavigation();
            
            // 滾動到頂部
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // 更新步驟文本
            updateStepText();
        }

        // 更新進度
        function updateProgress() {
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // 更新步驟文本
        function updateStepText() {
            const stepText = `步驟 ${currentStep}/${totalSteps}`;
            const stepTitle = stepTitles[currentStep - 1] || '';
            
            document.getElementById('currentStepText').textContent = stepText;
            document.getElementById('stepTitle').textContent = stepTitle;
        }

        // 更新導航按鈕
        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = currentStep === 1 ? 'none' : 'flex';
            
            if (currentStep === totalSteps) {
                document.getElementById('formNavigation').style.display = 'none';
            } else {
                document.getElementById('formNavigation').style.display = 'flex';
                
                if (currentStep === totalSteps - 1) {
                    nextBtn.innerHTML = '提交申請 <i class="fas fa-paper-plane"></i>';
                } else {
                    nextBtn.innerHTML = '下一步 <i class="fas fa-arrow-right"></i>';
                }
                
                // 如果是步驟9且未選擇時間，禁用下一步按鈕
                if (currentStep === 9 && selectedTimes.length === 0) {
                    nextBtn.disabled = true;
                } else {
                    nextBtn.disabled = false;
                }
            }
        }

        // 驗證當前步驟
        function validateCurrentStep() {
            const currentStepEl = document.getElementById(`step${currentStep}`);
            
            // 特殊驗證：步驟9需要選擇至少一個時間段
            if (currentStep === 9 && selectedTimes.length === 0) {
                showValidationError('請至少選擇一個首選時間段');
                return false;
            }
            
            const requiredFields = currentStepEl.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (field.type === 'radio') {
                    const name = field.name;
                    const checked = currentStepEl.querySelector(`input[name="${name}"]:checked`);
                    if (!checked) {
                        const labelText = getFieldLabel(field);
                        showValidationError(`請選擇「${labelText}」`);
                        return false;
                    }
                } else if (field.type === 'checkbox') {
                    // 檢查是否有至少一個checkbox被選中
                    const name = field.name;
                    const checkboxes = currentStepEl.querySelectorAll(`input[name="${name}"]`);
                    const checked = currentStepEl.querySelector(`input[name="${name}"]:checked`);
                    if (!checked && checkboxes.length > 0) {
                        const labelText = getFieldLabel(checkboxes[0]);
                        showValidationError(`請至少選擇一個「${labelText}」選項`);
                        return false;
                    }
                } else if (field.type === 'select-one') {
                    if (!field.value) {
                        const labelText = getFieldLabel(field);
                        showValidationError(`請選擇「${labelText}」`);
                        return false;
                    }
                } else {
                    if (!field.value.trim()) {
                        const labelText = getFieldLabel(field);
                        showValidationError(`請填寫「${labelText}」`);
                        return false;
                    }
                }
            }
            
            return true;
        }

        // 獲取字段標籤文本的輔助函數
        function getFieldLabel(field) {
            if (field.labels && field.labels.length > 0) {
                return field.labels[0].textContent.replace('*', '').trim();
            }
            
            // 嘗試從父元素獲取標籤
            const label = field.closest('.question-group')?.querySelector('label');
            if (label) {
                return label.textContent.replace('*', '').replace('required', '').trim();
            }
            
            // 嘗試獲取前一個label元素
            const prevLabel = field.previousElementSibling;
            if (prevLabel && prevLabel.tagName === 'LABEL') {
                return prevLabel.textContent.replace('*', '').trim();
            }
            
            return field.name || '此字段';
        }

        // 顯示驗證錯誤
        function showValidationError(message) {
            // 移除現有的錯誤提示
            const existingErrors = document.querySelectorAll('.validation-error');
            existingErrors.forEach(error => error.remove());
            
            // 創建錯誤提示元素
            const errorEl = document.createElement('div');
            errorEl.className = 'validation-error';
            errorEl.innerHTML = `<strong><i class="fas fa-exclamation-circle"></i> 請完善信息：</strong> ${message}`;
            
            // 插入到表單導航前
            const nav = document.getElementById('formNavigation');
            if (nav) {
                nav.parentNode.insertBefore(errorEl, nav);
                
                // 5秒後移除
                setTimeout(() => {
                    errorEl.style.opacity = '0';
                    errorEl.style.transform = 'translateY(-15px)';
                    setTimeout(() => errorEl.remove(), 300);
                }, 5000);
                
                // 滾動到錯誤位置
                errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // 收集表單數據
        function collectFormData() {
            // 收集復選框值
            const symptoms = Array.from(document.querySelectorAll('input[name="symptoms"]:checked')).map(cb => cb.value);
            const methods = Array.from(document.querySelectorAll('input[name="methods"]:checked')).map(cb => cb.value);
            
            return {
                // 聯繫信息
                igName: document.getElementById('igName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                
                // 年齡確認
                age: document.querySelector('input[name="age"]:checked')?.value,
                
                // 基礎生理數據
                gender: document.getElementById('gender').value,
                age_detail: document.getElementById('age_detail').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                waist: document.getElementById('waist').value,
                
                // 飲食習慣
                water: document.querySelector('input[name="water"]:checked')?.value,
                last_meal: document.getElementById('last_meal').value,
                breakfast: document.getElementById('breakfast').value,
                
                // 睡眠與壓力
                sleep_hours: document.getElementById('sleep_hours').value,
                morning_energy: document.getElementById('morning_energy').value,
                stress_level: document.getElementById('stress_level').value,
                
                // 身體徵兆
                symptoms: symptoms,
                
                // 減肥史與動機
                problem: document.getElementById('problem').value,
                methods: methods,
                pain_point: document.getElementById('pain_point').value,
                goal: document.getElementById('goal').value,
                
                // 目標與承諾
                commitment: document.querySelector('input[name="commitment"]:checked')?.value,
                investment: document.querySelector('input[name="investment"]:checked')?.value,
                
                // 補充信息
                follow_time: document.getElementById('follow_time').value,
                additionalInfo: document.getElementById('additionalInfo').value,
                
                // 會議規則
                rules: document.querySelector('input[name="rules"]:checked')?.value,
                
                // 時間意向
                preferredDate: document.getElementById('preferredDate').value,
                timePreferences: selectedTimes,
                
                // 同意事項
                understand: document.querySelector('input[name="understand"]:checked')?.value,
                
                // 時間戳
                submissionTime: new Date().toISOString()
            };
        }

        // 生成預約ID
        function generateAppointmentId() {
            const date = new Date();
            const year = date.getFullYear().toString().slice(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            
            return `MET${year}${month}${day}${random}`;
        }

        // 發送確認郵件
        async function sendConfirmationEmail(formData, appointmentId) {
            try {
                // 準備模板參數
                const templateParams = {
                    to_name: formData.igName || '客戶',
                    to_email: formData.email,
                    reply_to: formData.email,
                    appointment_id: appointmentId,
                    appointment_date: formData.preferredDate,
                    appointment_time: selectedTimes.join(', '),
                    contact: `Instagram: ${formData.igName || '未提供'}, 電話: ${formData.phone || '未提供'}`,
                    current_year: new Date().getFullYear().toString()
                };
                
                console.log('發送郵件參數:', templateParams);
                
                const response = await emailjs.send(
                    CONFIG.EMAILJS.SERVICE_ID,
                    CONFIG.EMAILJS.TEMPLATE_ID,
                    templateParams
                );
                
                console.log('郵件發送成功:', response);
                return { 
                    success: true, 
                    message: '確認郵件已發送',
                    emailResponse: response 
                };
                
            } catch (error) {
                console.error('郵件發送失敗:', error);
                return { 
                    success: false, 
                    message: `郵件發送失敗: ${error.text || error.message || '未知錯誤'}`,
                    error: error 
                };
            }
        }

        // 保存到本地存儲
        function saveToLocalStorage(formData, appointmentId, emailSent, backupSent) {
            const appointments = JSON.parse(localStorage.getItem('metabolic_appointments')) || [];
            
            const appointment = {
                id: appointmentId,
                timestamp: new Date().toISOString(),
                ...formData,
                emailSent: emailSent,
                backupSent: backupSent,
                status: 'pending_confirmation',
                version: '3.0' // 標記為專業版
            };
            
            appointments.push(appointment);
            localStorage.setItem('metabolic_appointments', JSON.stringify(appointments));
            
            console.log('預約已保存到本地存儲:', appointment);
            return appointment;
        }

        // 顯示成功信息
        function showSuccessMessage(formData, appointmentId, emailResult, backupResult) {
            // 格式化日期
            const date = new Date(formData.preferredDate);
            const formattedDate = date.toLocaleDateString('zh-TW', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            const detailsHTML = `
                <div class="detail-row">
                    <div class="detail-label">預約編號</div>
                    <div class="detail-value"><strong>${appointmentId}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">您的稱呼</div>
                    <div class="detail-value">${formData.igName || '未提供'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">聯繫郵箱</div>
                    <div class="detail-value">${formData.email}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">首選日期</div>
                    <div class="detail-value">${formattedDate}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">首選時間</div>
                    <div class="detail-value">${selectedTimes.join(', ') || '未選擇'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">主要目標</div>
                    <div class="detail-value">${formData.goal ? formData.goal.substring(0, 60) + (formData.goal.length > 60 ? '...' : '') : '未提供'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">代謝決心</div>
                    <div class="detail-value">${formData.commitment || '未提供'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">郵件狀態</div>
                    <div class="detail-value">
                        ${emailResult.success ? 
                            '<span style="color: #10b981;"><i class="fas fa-check-circle"></i> 確認郵件已發送</span>' : 
                            '<span style="color: #ef4444;"><i class="fas fa-exclamation-triangle"></i> 郵件發送失敗</span>'}
                    </div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">數據備份</div>
                    <div class="detail-value">
                        <span style="color: #10b981;"><i class="fas fa-check-circle"></i> 數據已安全保存</span>
                    </div>
                </div>
            `;
            
            document.getElementById('appointmentDetails').innerHTML = detailsHTML;
        }

        // 處理表單提交
        async function handleFormSubmit() {
            // 收集表單數據
            const collectedData = collectFormData();
            const appointmentId = generateAppointmentId();
            
            // 顯示加載狀態
            const submitBtn = document.getElementById('nextBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 提交中...';
            submitBtn.disabled = true;
            
            try {
                // 1. 發送確認郵件
                const emailResult = await sendConfirmationEmail(collectedData, appointmentId);
                
                // 2. 保存到本地存儲
                const savedAppointment = saveToLocalStorage(collectedData, appointmentId, emailResult.success, true);
                
                // 3. 顯示成功信息
                showSuccessMessage(collectedData, appointmentId, emailResult, {success: true});
                
                // 4. 跳轉到成功頁面
                goToStep(totalSteps);
                
                // 5. 更新社群連結
                updateSocialLinks();
                
            } catch (error) {
                console.error('提交失敗:', error);
                
                // 顯示錯誤信息
                const errorEl = document.createElement('div');
                errorEl.style.cssText = `
                    background: #fee2e2;
                    color: #991b1b;
                    padding: 25px;
                    border-radius: 14px;
                    margin: 25px 0;
                    border-left: 5px solid #dc2626;
                    text-align: center;
                `;
                errorEl.innerHTML = `
                    <h4 style="margin-bottom: 12px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> 提交過程中發生錯誤
                    </h4>
                    <p style="margin-bottom: 15px;">系統保存了您的預約信息，但郵件發送可能失敗。</p>
                    <p style="margin-bottom: 15px;">預約編號：<strong>${appointmentId}</strong></p>
                    <p style="margin-bottom: 20px;">請記錄此編號，並通過 Instagram 與我們聯繫確認。</p>
                    <button onclick="window.location.reload()" style="
                        background: #dc2626;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 12px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s;
                    ">
                        重新嘗試
                    </button>
                `;
                
                const nav = document.getElementById('formNavigation');
                if (nav) {
                    nav.parentNode.insertBefore(errorEl, nav);
                }
                
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                // 顯示成功頁面（即使有錯誤）
                showSuccessMessage(collectedData, appointmentId, {success: false, message: '郵件發送失敗'}, {success: true});
                goToStep(totalSteps);
                updateSocialLinks();
            }
        }

        // 更新社群連結
        function updateSocialLinks() {
            // 更新Instagram連結
            const instagramBtn = document.querySelector('.community-btn.instagram');
            if (instagramBtn && CONFIG.SOCIAL.INSTAGRAM) {
                instagramBtn.href = CONFIG.SOCIAL.INSTAGRAM;
            }
            
            // 更新WhatsApp連結
            const whatsappBtn = document.querySelector('.community-btn.whatsapp');
            if (whatsappBtn && CONFIG.SOCIAL.WHATSAPP) {
                whatsappBtn.href = CONFIG.SOCIAL.WHATSAPP;
            }
        }

        // 初始化社群連結
        updateSocialLinks();
    </script>
</body>
</html>
